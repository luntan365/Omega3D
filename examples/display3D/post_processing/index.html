<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Omega3d - Basic Low Quality ShadowMapping Demo</title>
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <script language="JavaScript" src="../../../src/Omega3d.min.v0015.js"></script>
</head>
<script type="text/javascript">
    var scene, camera, light;
    var postprocessing_scene;
    var chain, renderer, quad;
    var geometry, shader, material, texture, mesh;
    var pp_texture_01,pp_texture_02;


    function init(){
        Omega3D.Recalibrate();
        buildScene();
        buildFullScreenQuadScene();
        buildRenderChain();
        render();
    }

    function buildScene(){
        scene = new Omega3D.Scene();
        camera = new Omega3D.cameras.Camera();
        camera.LookAt( 0, 0, 0, [ 0, -3, -3]);

        light = new Omega3D.Light( Omega3D.DIRECTIONAL_LIGHT );
        light.SetDirection( 0, 1, 1);
        light.SetDiffuse( 1.0, 1.0, 1.0);
        light.SetAmbient( 0.5, 0.5, 0.5 );
       // light.GenerateGLSL();
       // scene.addLight( light );

        var size = 0.5;
        geometry = new Omega3D.Geometry.CubeGeometry(size, size, size);
        mesh     = new Omega3D.Mesh( geometry );
        material = new Omega3D.BasicMaterial([], scene, [1.0, 0.5, 0.1] );

        var object = new Omega3D.Object3D(mesh, material);
        scene.addChild(object);
    }

    function buildFullScreenQuadScene(){
        postprocessing_scene = new Omega3D.Scene();
        geometry       = new Omega3D.Geometry.SquareGeometry(1, 1);
        mesh           = new Omega3D.Mesh( geometry );
        shader         = new Omega3D.Shaders.PostProcessing( true, postprocessing_scene );
        pp_texture_01  = new Omega3D.FrameBufferTexture();
        pp_texture_02  = new Omega3D.FrameBufferTexture();
        material       = new Omega3D.Material( shader, [pp_texture_01]);
        quad            = new Omega3D.Object3D(mesh, material);
        postprocessing_scene.addChild( quad );
    }

    function buildRenderChain(){
        renderer = new Omega3D.WebGLRenderer();
        chain    = new Omega3D.RenderChain();
        chain.AddRenderPass( new RenderToTexturePass( renderer, scene, camera, pp_texture_01 ));
        chain.AddRenderPass( new PostProcessingPass( renderer, quad, new Omega3D.Shaders.PP_Bloom()               , pp_texture_02 ));
        chain.AddRenderPass( new PostProcessingPass( renderer, quad, new Omega3D.Shaders.PP_ColorMultiply( "2.0" ), pp_texture_01 ));
        chain.AddRenderPass( new RenderPass( renderer, postprocessing_scene, camera ));
        renderer.SetRenderChain(chain);
    }

    function render(){
        requestAnimationFrame(render);
        camera.LookAt( 0, 0, 0,[ Math.cos( scene.getTime() / 2.2) * 1.75,
                                Math.sin( scene.getTime() / 2.4) * 1.57,
                                Math.sin( scene.getTime() / 1.7) * 1.1]);
        renderer.render();
    }


</script>
<body>
<body onload="init();" style="padding:0;margin:0;">
<canvas id="omega" width="900px" height="900px"></canvas>
<a href="http://lab.rackdoll.nl/js/omega/" target="_blank"><img  src="../../omega.png" style="position:absolute;top:15px;left:15px;width:150px;"/></a>
</body>
</html>
