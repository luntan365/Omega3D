var OMEGA = OMEGA || {};OMEGA.Audio = OMEGA.Audio || {};OMEGA.Audio.ctx= null;OMEGA.Audio.sounds = null;OMEGA.Audio.succesCallback = null;OMEGA.Audio = function(){try{window.AudioCosntext = window.AudioContext || window.webkitAudioContext;OMEGA.Audio.ctx = new AudioContext();OMEGA.Audio.sounds = [];console.log('Welcome to OmegaAudio');}catch(e){alert('This browser does not support Web Audio')};};OMEGA.Audio.LoadSounds = function( data, successCallback ){OMEGA.Audio.succesCallback = successCallback;var loader = new OMEGA.Audio.Loader(data,function(b){for( var k in b ){OMEGA.Audio.sounds[k] = new OMEGA.Audio.Sound(k, b[k]);}OMEGA.Audio.succesCallback();});loader.load();};OMEGA.Audio.PlaySound = function( id, time ){var timeValue = time || 0.0;OMEGA.Audio.sounds[id].setVolume(1.0);OMEGA.Audio.sounds[id].play(timeValue);};OMEGA.Audio();OMEGA.Audio.DrRythm = function( bpm ){this.beatsPerMinute = bpm;this.eightNoteTime = ( 60 /this.beatsPerMinute ) * 0.5;this.sixteenthNoteTime = ( 60 /this.beatsPerMinute ) * 0.25;this.current8Note= 0;this.current16Note = 0;this.nextNodeTime = 0;this.scheduleAheadTime = 0.1;};OMEGA.Audio.DrRythm.prototype.tick8 = function(){while (this.nextNodeTime < OMEGA.Audio.ctx.currentTime + this.scheduleAheadTime ) {console.log("tick8 : " + this.current8Note + " @ " + this.beatsPerMinute + "BPM");this.nextNodeTime += this.eightNoteTime;this.current8Note++;if (this.current8Note == 8)this.current8Note = 0;}};OMEGA.Audio.DrRythm.prototype.tick16 = function(){while (this.nextNodeTime < OMEGA.Audio.ctx.currentTime + this.scheduleAheadTime ) {console.log("tick16 : " + this.current16Note + " @ " + this.beatsPerMinute + "BPM");this.nextNodeTime += this.sixteenthNoteTime;this.current16Note++;if (this.current16Note == 16)this.current16Note = 0;}};OMEGA.Audio.Loader = function( data, successCallback){this.data = data;this.onLoaded = successCallback;this.loadCount = 0;this.buffers = [];};OMEGA.Audio.Loader.prototype.loadURL = function( url, id ){var loader = this;var request = new XMLHttpRequest();request.open("GET", url, true);request.responseType = "arraybuffer";request.onload = function() {OMEGA.Audio.ctx.decodeAudioData(request.response,function(buffer) {loader.buffers[id] = buffer;if (++loader.loadCount == loader.data.length){loader.onLoaded(loader.buffers);}},function(error) {console.error('decodeAudioData error', error);})};request.onerror = function() { alert('BufferLoader: XHR error');};request.send();};OMEGA.Audio.Loader.prototype.load = function(){for( var i = 0; i < this.data.length; i++) {this.loadURL(this.data[i].path, this.data[i].id);}};OMEGA.Audio = OMEGA.Audio || { };OMEGA.Audio.Sound = function( id, buffer ){this.sound_id = id;this.sound_buffer = buffer;this.sound_src = null;this.gainNode = OMEGA.Audio.ctx.createGain();this.gainNode.gain.value = 1.0;};OMEGA.Audio.Sound.prototype.getID = function(){return this.sound_id;};OMEGA.Audio.Sound.prototype.setVolume = function( value ){this.gainNode.gain.value = value;};OMEGA.Audio.Sound.prototype.getVolume = function( value ){return this.gainNode.gain.value;};OMEGA.Audio.Sound.prototype.play = function(time){this.sound_src = OMEGA.Audio.ctx.createBufferSource();this.sound_src.buffer = this.sound_buffer;this.sound_src.connect(this.gainNode);this.gainNode.connect(OMEGA.Audio.ctx.destination);this.sound_src.start(time);};