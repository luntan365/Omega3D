function Vector2(a,b){this.x=a,this.y=b,__construct=void 0,this.add=function(a){return this.x+=a.x,this.y+=a.y,this},this.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},this.multiply=function(a){return this.x*=a,this.y*=a,this},this.zero=function(){return this.x=0,this.y=0,this}}function Vector3(a,b,c){this.x=a,this.y=b,this.z=c,__construct=void 0,this.add=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},this.subtract=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},this.multiply=function(a){return this.x*=a,this.y*=a,this.z*=a,this},this.zero=function(){return this.x=0,this.y=0,this.z=0,this}}function Object3D(a,b){this.id=(++OMEGA.Omega3D.ObjectsCount).toString(),this.name="Object3d_"+this.id.toString(),this.mayRender=!0,this.next=null,this.prev=null,this.parentScene=null,this.position=[0,0,0],this.rotation=[0,0,0],this.scale=[1,1,1],this.sMatrix=mat4.create(),this.tMatrix=mat4.create(),this.rMatrix=mat4.create(),this.modelView=mat4.create(),mat4.identity(this.modelView),this.mesh=a,this.material=b,this.drawType=OMEGA.Omega3D.Object3D.DEFAULT,this.mesh&&this.mesh.CreateBuffers(),this.SetName=function(a){this.name=a},this.SetMesh=function(a){this.mesh=a},this.SetMaterial=function(a){this.material=a},this.SetMatrix=function(a){this.modelView=a},this.GetPosition=function(){return this.position},this.GetRotation=function(){return this.rotation},this.GetMesh=function(){return this.mesh},this.GetMaterial=function(){return this.material},this.GetMatrix=function(){return mat4.identity(this.modelView),mat4.multiply(this.modelView,this.tMatrix,this.rMatrix),mat4.multiply(this.modelView,this.modelView,this.sMatrix),this.modelView},this.GetName=function(){return this.name},this.GetID=function(){return this.id},this.Identity=function(){this.position=[0,0,0],this.rotation=[0,0,0],this.scale=[1,1,1],this.SetScale(this.scale[0],this.scale[1],this.scale[2]),this.SetPosition(this.position[0],this.position[1],this.position[2]),this.SetRotation(this.rotation[0],this.rotation[1],this.rotation[2]),mat4.identity(this.modelView)},this.PlaceBack=function(){this.SetScale(this.scale[0],this.scale[1],this.scale[2]),this.SetPosition(this.position[0],this.position[1],this.position[2]),this.SetRotation(this.rotation[0],this.rotation[1],this.rotation[2])},this.SetScale=function(a,b,c){this.scale=[a,b,c],mat4.identity(this.sMatrix),mat4.scale(this.sMatrix,this.sMatrix,this.scale)},this.SetPosition=function(a,b,c){this.position=[a,b,c],mat4.identity(this.tMatrix),mat4.translate(this.tMatrix,this.tMatrix,this.position)},this.Translate=function(a,b,c){this.position[0]+=a,this.position[1]+=b,this.position[2]+=c,mat4.identity(this.tMatrix),mat4.translate(this.tMatrix,this.tMatrix,this.position)},this.SetRotation=function(a,b,c){mat4.identity(this.rMatrix),this.rotation=[a,b,c],mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[0],[1,0,0]),mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[1],[0,1,0]),mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[2],[0,0,1])},this.Rotate=function(a,b,c){mat4.identity(this.rMatrix),this.RotateX(a),this.RotateY(b),this.RotateZ(c)},this.RotateX=function(a){this.rotation[0]+=a,mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[0],[1,0,0])},this.RotateY=function(a){this.rotation[1]+=a,mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[1],[0,1,0])},this.RotateZ=function(a){this.rotation[2]+=a,mat4.rotate(this.rMatrix,this.rMatrix,this.rotation[2],[0,0,1])},this.Update=function(){},this.LateUpdate=function(){},this.toString=function(){return"Object3D { id: "+this.id+", name: "+this.name+"};"}}function LODObject3D(a,b,c){Object3D.apply(this,[a,b]),this.levels=c,this.current_level=0,this.meshes=new Array,this.createMeshes=function(){for(var a=0;a<this.levels+1;a++){var b=new Omega3D.Geometry.SphereGeometry(this.mesh.GetGeometry().scale,6+3*a,2+5*a),c=new Mesh(b);c.CreateBuffers(),this.meshes.push(c)}this.SetMesh(this.meshes[this.current_level])},this.adjustLODLevel=function(a){var b=a.GetPosition(),c=this.GetPosition(),d=[-b[0]-c[0],-b[1]-c[1],-b[2]-c[2]],e=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])/(2*this.mesh.GetGeometry().scale),f=this.levels-Math.floor(e);f!=this.current_level&&(this.current_level=f>this.levels?this.levels:0>f?0:f,this.SetMesh(this.meshes[this.current_level]))},this.mesh&&this.createMeshes()}function Cube(a,b){Object3D.apply(this,[new Omega3D.Mesh(new Omega3D.Geometry.CubeGeometry(a)),b])}function Camera(){Object3D.apply(this),this.projectionMatrix=mat4.create(),this.laMatrix=mat4.create(),this.near=.1,this.far=1e3,this.GetProjectionMatrix=function(){return mat4.perspective(this.projectionMatrix,45,OMEGA.Omega3D.GL.viewPortWidth/OMEGA.Omega3D.GL.viewPortHeight,this.near,this.far),this.projectionMatrix},this.GetMatrix=function(){return mat4.identity(this.modelView),mat4.multiply(this.modelView,this.rMatrix,this.tMatrix),mat4.multiply(this.modelView,this.modelView,this.sMatrix),mat4.multiply(this.modelView,this.modelView,this.laMatrix),this.modelView},this.GetInverseMatrix=function(){var a=mat4.create();return mat4.invert(a,this.GetMatrix()),mat4.transpose(a,a),a},this.update=function(){},this.LookAt=function(a,b,c,d){mat4.identity(this.laMatrix),mat4.lookAt(this.laMatrix,d||this.position,[a,b,c],[0,-1,0])}}function FreeCamera(){Camera.apply(this),this.speed=.1,this.drag=.1,this.mass=1,this.force=0,this.pos=new Vector2(0,0,0),this.vel=new Vector2(0,0,0),this.rot=new Vector2(0,0,0),this.rotF=new Vector2(0,0,0),this.acc=new Vector2(0,0,0),this.rot_acc=new Vector2(0,0,0),this.enabled=!0,this.listener=null,this.dirX,this.dirY,this.dirZ,this.SetListener=function(a){this.listener=a},this.GetListener=function(){return this.listener},this.SetSpeed=function(a){this.speed=a},this.update=function(){this.listener&&this.enabled&&(this.HandleKeys(),this.dirX=Math.cos(this.rot.y+Math.PI/2),this.dirZ=Math.sin(this.rot.y+Math.PI/2),this.dirY=Math.sin(this.rot.x),this.vel.z=this.force*this.dirZ,this.vel.x=this.force*this.dirX,this.vel.y=this.force*this.dirY,this.pos.z+=this.vel.z,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.force*=this.drag,this.SetRotation(this.rot.x,this.rot.y,0),this.SetPosition(this.pos.x,this.pos.y,this.pos.z))},this.HandleKeys=function(){this.listener.currentlyPressedKeys[87]&&(this.vel.z=0,this.force+=this.speed),this.listener.currentlyPressedKeys[83]&&(this.vel.z=0,this.force+=-this.speed),(this.listener.currentlyPressedKeys[39]||this.listener.currentlyPressedKeys[68]||this.listener.currentlyPressedKeys[102])&&(this.rotF.y=.05,this.rot.y+=this.rotF.y),(this.listener.currentlyPressedKeys[37]||this.listener.currentlyPressedKeys[65]||this.listener.currentlyPressedKeys[100])&&(this.rotF.y=-.05,this.rot.y+=this.rotF.y),(this.listener.currentlyPressedKeys[38]||this.listener.currentlyPressedKeys[104])&&(this.rotF.x=-.05,this.rot.x+=this.rotF.x),(this.listener.currentlyPressedKeys[40]||this.listener.currentlyPressedKeys[98])&&(this.rotF.x=.05,this.rot.x+=this.rotF.x),this.listener.currentlyPressedKeys[90]&&(this.vel.x=0,this.acc.x+=this.speed),this.listener.currentlyPressedKeys[67]&&(this.vel.x=0,this.acc.x-=this.speed),this.listener.currentlyPressedKeys[81]&&(this.vel.y=0,this.acc.y+=this.speed),this.listener.currentlyPressedKeys[69]&&(this.vel.y=0,this.acc.y-=this.speed)},this.Enable=function(){this.enabled||(this.listener&&this.listener.Enable(),this.enabled=!0)},this.Disable=function(){this.enabled&&(this.listener&&this.listener.Disable(),this.enabled=!1)},this.Enable()}function Material(a,b){this.materialID="material_"+ ++OMEGA.Omega3D.MaterialsCount,this.textures=b||null,this.shader=a||null,this.GetTextures=function(){return this.textures},this.SetTextures=function(a){this.textures=a},this.GetShader=function(){return this.shader},this.SetShader=function(a){this.shader=a},this.GetID=function(){return this.materialID},this.Enable=function(){if(this.shader&&this.shader.Enable(),this.textures)for(var a=0;a<this.textures.length;a++)this.textures[a].Enable(this.shader)},this.Disable=function(){if(this.shader&&this.shader.Disable(),this.textures)for(var a=this.textures.length,b=0;a>b;b++)this.textures[b].Disable()}}function SEMMaterial(a,b){Material.apply(this,[new Omega3D.Shaders.SEM(b),a])}function ShaderMaterial(a,b){var c={},d={};d.aTextureCoord={type:"vec2",glsl:"attribute vec2 aTextureCoord;",value:null},d.aVertexPos={type:"vec3",glsl:"attribute vec3 aVertexPos;",value:null},d.aVertexNormal={type:"vec3",glsl:"attribute vec3 aVertexNormal;",value:null},d.aVertexTangent={type:"vec3",glsl:"attribute vec3 aVertexTangent;",value:null},d.aVertexBitangent={type:"vec3",glsl:"attribute vec3 aVertexBitangent;",value:null},this.attribs=d;var e={};e.uModelMatrix={type:"mat4",glsl:"uniform mat4 uModelMatrix;",value:null},e.uProjectionMatrix={type:"mat4",glsl:"uniform mat4 uProjectionMatrix;",value:null},e.uViewMatrix={type:"mat4",glsl:"uniform mat4 uViewMatrix;",value:null},e.uInvViewMatrix={type:"mat4",glsl:"uniform mat4 uInvViewMatrix;",value:null},e.uNormalMatrix={type:"mat3",glsl:"uniform mat3 uNormalMatrix;",value:null},this.uniforms=e;var f={},g={};this.custom_uniforms=f,this.custom_attribs=g,this.Clear=function(){for(var a in f)f[a]={type:f[a].type,glsl:f[a].glsl,value:null}},this.SetValue=function(a,b){var c=e[a]||d[a]||f[a];c&&(c.value=b)},this.GetValue=function(a){var b=e[a]||d[a]||f[a]||{value:null};return b.value},this.processData=function(a){var b=0;for(var d in a.uniforms){var e="";e="uniform "+a.uniforms[d].type+" "+d+";","sampler2D"!=a.uniforms[d].type&&"samplerCube"!=a.uniforms[d].type?f[d]={type:a.uniforms[d].type,glsl:e,value:a.uniforms[d].value}:(c[d]={id:d,type:a.uniforms[d].type,glsl:e,value:null},a.uniforms[d].value.tex_id=d,a.uniforms[d].value.ID=b++,this.textures.push(a.uniforms[d].value))}for(var d in a.attribs){var e="";e="attribute "+a.attribs[d].type+" "+d+";",g[d]={type:a.attribs[d].type,glsl:e,value:a.attribs[d].value}}};var h=function(){OMEGA.Omega3D.Log(" >> ShaderMaterial: Creating custom shader");var h="";h+=i(d),h+=i(g),h+=i(e),h+=a.vertex_src;var j="precision mediump float;";j+=a.fragment_src;var k=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(h,j,e,b);return e=k.uniforms,h=k.vs,j=k.fs,new OMEGA.Omega3D.Shader(h,j,[d,e,f,c,g])},i=function(a){var b="";for(var c in a)b+="\n"+a[c].glsl;return b};Material.apply(this,[null,[]]),this.processData(a),this.shader=h()}function ShadowMapMaterial(a,b,c){Material.apply(this,[new OMEGA.Omega3D.Shaders.SM(b),a]),this.shadowMapTexture=new ShadowMapTexture(1024,1024,a.length),this.textures.push(this.shadowMapTexture),this.custom_uniforms={},this.custom_uniforms.uLightM={type:"mat4",glsl:"",value:c.GetMatrix()}}function CubeMapMaterial(a,b){Material.apply(this,[new OMEGA.Omega3D.Shaders.CubeMap(b),a])}function BasicMaterial(a,b,c){Material.apply(this,[new OMEGA.Omega3D.Shaders.Basic(a.length>0,b,c?c:[1,1,1]),a])}function Shader(a,b,c){this.vars=c,this.vertex_shader_src=a,this.fragment_shader_src=b,this.program=null,this.GetVertexShaderSource=function(){return this.vertex_shader_src},this.GetFragmentShaderSource=function(){return this.fragment_shader_src},this.GetVertexShader=function(){return this.vertex_shader},this.GetFragmentShader=function(){return this.fragment_shader},this.GetProgram=function(){return this.program},this.Enable=function(){this.program&&this.gl_context.useProgram(this.program)},this.Disable=function(){this.program&&this.gl_context.useProgram(null)},this.createProgram=function(){if(null!=this.vertex_shader&&null!=this.fragment_shader){if(this.program=this.gl_context.createProgram(),this.gl_context.attachShader(this.program,this.vertex_shader),this.gl_context.attachShader(this.program,this.fragment_shader),this.gl_context.linkProgram(this.program),!this.gl_context.getProgramParameter(this.program,this.gl_context.LINK_STATUS))return OMEGA.Omega3D.Log("   -- Could not initialize shaders / program"),null;if(c)for(var b in c)for(var d in c[b])this.program[d]=0==b||4==b?this.gl_context.getAttribLocation(this.program,d.toString()):this.gl_context.getUniformLocation(this.program,d.toString());return this.gl_context.validateProgram(this.program),this.gl_context.getProgramParameter(this.program,this.gl_context.VALIDATE_STATUS)?(this.gl_context.detachShader(this.program,this.vertex_shader),this.gl_context.detachShader(this.program,this.fragment_shader),this.gl_context.deleteShader(this.vertex_shader),this.gl_context.deleteShader(this.fragment_shader),OMEGA.Omega3D.Log("   -- Program succesfully created!"),this.program):(OMEGA.Omega3D.Log("   -- Program validation failed!"),null)}},this.createShaderElement=function(a,b){if(!b)return null;var c=this.gl_context.createShader(a);return this.gl_context.shaderSource(c,b),this.gl_context.compileShader(c),this.gl_context.getShaderParameter(c,this.gl_context.COMPILE_STATUS)?(OMEGA.Omega3D.Log((a==this.gl_context.VERTEX_SHADER?"   -- Vertex component: ":"   -- Fragment component: ")+"succesfully compiled!"),c):(OMEGA.Omega3D.Log((a==this.gl_context.VERTEX_SHADER?"  -- Vertex component: ":"   -- Fragment component: ")+this.gl_context.getShaderInfoLog(c)),null)},this.GetSamplerLocation=function(a){for(var b in c)for(var d in c[b])if("sampler2D"==c[b][d].type||"samplerCube"==c[b][d].type){if(null==a)return this.program[d];if(a==d)return this.program[d]}return-1},this.gl_context=OMEGA.Omega3D.GL,this.vertex_shader=this.gl_context?this.createShaderElement(this.gl_context.VERTEX_SHADER,this.vertex_shader_src):null,this.fragment_shader=this.gl_context?this.createShaderElement(this.gl_context.FRAGMENT_SHADER,this.fragment_shader_src):null,this.program=this.gl_context?this.createProgram():null}function Texture(a,b,c){return OMEGA.Omega3D.GL?(this.ID=c||0,this.gl_context=OMEGA.Omega3D.GL,this.img=a,this.isCubeMap=!0,this.needsUpdate=b||!1,this.tex=this.gl_context.createTexture(),this.tex_id="uSampler",this.isEnabled=!1,this.isDirty=!0,this.GetTexture=function(){return this.tex},this.GetImage=function(){return this.img},this.SetImage=function(a){this.img=a,this.isDirty=!0},this.handleTextureLoaded=function(){},this.Enable=function(){},this.Disable=function(){},this.IsPowerOf2=function(a){return 0==(a&a-1)},this.Update=function(){this.isDirty&&(this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,!0),this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,this.img),this.isDirty=!1)},this.GenerateMipmap=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),this.gl_context.generateMipmap(this.gl_context.TEXTURE_2D),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null)},void 0):null}function BasicTexture(){Texture.apply(this,arguments),this.handleTextureLoaded=function(a,b){this.needsUpdate?(this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,b),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE)):(this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,b),this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,!0),a&&this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,this.ID,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,a),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST),a&&this.IsPowerOf2(a.width)&&this.IsPowerOf2(a.height)?(this.gl_context.generateMipmap(this.gl_context.TEXTURE_2D),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST_MIPMAP_LINEAR)):(a&&this.gl_context.generateMipmap(this.gl_context.TEXTURE_2D),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE)),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null))},this.Enable=function(a){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),a&&this.img&&this.gl_context.uniform1i(a.GetSamplerLocation(this.tex_id),this.ID)},this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null)},this.handleTextureLoaded(this.img,this.tex)}function CubemapTexture(){Texture.apply(this,arguments),this.handleTextureLoaded=function(a,b){this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,b),this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_CUBE_MAP,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR);for(var c=[this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_X,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_X,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Y,this.gl_context.TEXTURE_CUBE_MAP_POSITIVE_Z,this.gl_context.TEXTURE_CUBE_MAP_NEGATIVE_Z],d=0;d<c.length;d++)this.gl_context.pixelStorei(this.gl_context.UNPACK_FLIP_Y_WEBGL,!0),this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,b),this.gl_context.texImage2D(c[d],0,this.gl_context.RGBA,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,a[d]),this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,null)},this.Enable=function(a){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID),this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,this.tex),a&&this.gl_context.uniform1i(a.GetSamplerLocation(),this.ID)},this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_CUBE_MAP,null)},this.handleTextureLoaded(this.img,this.tex)}function ShadowMapTexture(a,b,c){Texture.apply(this,[null,!0,c]),this.tex_id="uShadowMap";var d=this.gl_context.getExtension("WEBKIT_WEBGL_depth_texture");if(!d)return alert("Depthtextures not available in this browser."),void 0;var e=this.gl_context.createFramebuffer();this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,e),e.width=a||1024,e.height=b||1024,this.tex=this.gl_context.createTexture(),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.NEAREST),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.NEAREST),this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.DEPTH_COMPONENT,e.width,e.height,0,this.gl_context.DEPTH_COMPONENT,this.gl_context.UNSIGNED_SHORT,null),this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.TEXTURE_2D,this.tex,0),!this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)===this.gl_context.FRAMEBUFFER_COMPLETE&&console.error("[ShadowMapTexture] Framebuffer incomplete!"),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null),this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null),this.GetFrameBuffer=function(){return e},this.Enable=function(a){this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),a&&this.gl_context.uniform1i(a.GetSamplerLocation(this.tex_id),this.ID)}}function FrameBufferTexture(a,b,c){Texture.apply(this,[null,!0],c);var d,e;d=this.gl_context.createFramebuffer(),this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,d),d.width=a||1024,d.height=b||1024,this.tex=this.gl_context.createTexture(),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_S,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_WRAP_T,this.gl_context.CLAMP_TO_EDGE),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MAG_FILTER,this.gl_context.LINEAR),this.gl_context.texParameteri(this.gl_context.TEXTURE_2D,this.gl_context.TEXTURE_MIN_FILTER,this.gl_context.LINEAR),this.gl_context.texImage2D(this.gl_context.TEXTURE_2D,0,this.gl_context.RGBA,d.width,d.height,0,this.gl_context.RGBA,this.gl_context.UNSIGNED_BYTE,null);var e=this.gl_context.createRenderbuffer();this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,e),this.gl_context.renderbufferStorage(this.gl_context.RENDERBUFFER,this.gl_context.DEPTH_COMPONENT16,d.width,d.height),this.gl_context.framebufferTexture2D(this.gl_context.FRAMEBUFFER,this.gl_context.COLOR_ATTACHMENT0,this.gl_context.TEXTURE_2D,this.tex,0),this.gl_context.framebufferRenderbuffer(this.gl_context.FRAMEBUFFER,this.gl_context.DEPTH_ATTACHMENT,this.gl_context.RENDERBUFFER,e),!this.gl_context.checkFramebufferStatus(this.gl_context.FRAMEBUFFER)===this.gl_context.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null),this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,null),this.gl_context.bindFramebuffer(this.gl_context.FRAMEBUFFER,null),this.Enable=function(a){if(this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,e),this.gl_context.activeTexture(this.gl_context.TEXTURE0+this.ID),this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,this.tex),a){var b=a.GetSamplerLocation(this.tex_id);this.gl_context.uniform1i(b,this.ID)}},this.GetFrameBuffer=function(){return d},this.Disable=function(){this.gl_context.bindTexture(this.gl_context.TEXTURE_2D,null),this.gl_context.bindRenderbuffer(this.gl_context.RENDERBUFFER,null)}}function Mesh(a){this.vertexBuffer,this.normalBuffer,this.indexBuffer,this.uvBuffer,this.tangentBuffer,this.bitangentBuffer,this.geometry=a,this.gl=OMEGA.Omega3D.GL,this.GetVertexBuffer=function(){return this.vertexBuffer},this.GetUVBuffer=function(){return this.uvBuffer},this.GetIndexBuffer=function(){return this.indexBuffer},this.GetNormalBuffer=function(){return this.normalBuffer},this.GetTangentBuffer=function(){return this.tangentBuffer},this.GetBitangentBuffer=function(){return this.bitangentBuffer},this.GetIndexCount=function(){return this.geometry.GetIndexes()/3},this.GetGeometry=function(){return this.geometry},this.ApplyGeometry=function(a){this.geometry=a,this.CreateBuffers()},this.CreateBuffers=function(){this.geometry.GetVertices().length>0&&(this.vertexBuffer||(this.vertexBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.geometry.GetVertices()),this.gl.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=this.geometry.GetVertices().length/this.vertexBuffer.itemSize),this.geometry.GetNormals().length>0&&(this.normalBuffer||(this.normalBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.normalBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.geometry.GetNormals()),this.gl.STATIC_DRAW),this.normalBuffer.itemSize=3,this.normalBuffer.numItems=this.geometry.GetNormals().length/3),this.geometry.GetIndexes().length>0&&(this.indexBuffer||(this.indexBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.geometry.GetIndexes()),this.gl.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=this.geometry.GetIndexes().length),this.geometry.GetUVS().length>0&&(this.uvBuffer||(this.uvBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.geometry.GetUVS()),this.gl.STATIC_DRAW),this.uvBuffer.itemSize=2,this.uvBuffer.numItems=this.geometry.GetUVS().length/this.uvBuffer.itemSize),this.geometry.GetTangents().length>0&&(this.tangentBuffer||(this.tangentBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.tangentBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.geometry.GetTangents()),this.gl.STATIC_DRAW),this.tangentBuffer.itemSize=3,this.tangentBuffer.numItems=this.geometry.GetTangents().length/this.tangentBuffer.itemSize),this.geometry.GetBitangents().length>0&&(this.bitangentBuffer||(this.bitangentBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.bitangentBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.geometry.GetBitangents()),this.gl.STATIC_DRAW),this.bitangentBuffer.itemSize=3,this.bitangentBuffer.numItems=this.geometry.GetBitangents().length/this.bitangentBuffer.itemSize)}}function Geometry(){this.vertices=new Array,this.normals=new Array,this.uvs=new Array,this.tangents=new Array,this.bitangents=new Array,this.vertices_raw=new Array,this.normals_raw=new Array,this.uvs_raw=new Array,this.tangents_raw=new Array,this.bitangents_raw=new Array,this.indexes=new Array,this.faces=new Array,this.scale=1,this.SetVertices=function(a){this.vertices=a},this.SetNormals=function(a){this.normals=a},this.SetUVS=function(a){this.uvs=a},this.SetIndexes=function(a){this.indexes=a},this.SetFaces=function(a){this.faces=a},this.SetTangents=function(a){this.tangents=a},this.SetBitangents=function(a){this.bitangents=a},this.GetVertices=function(){return this.vertices},this.GetNormals=function(){return this.normals},this.GetUVS=function(){return this.uvs},this.GetTangents=function(){return this.tangents},this.GetBitangents=function(){return this.bitangents},this.GetIndexes=function(){return this.indexes},this.GetFaces=function(){return this.faces},this.GetLengthBetweenPoints=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z,f=c*c+d*d+e*e;return Math.sqrt(f)}}function CubeGeometry(a,b,c){Geometry.apply(this);var d=a/2||this.scale,e=b/2||d||this.scale,f=c/2||d||this.scale;this.vertices=[-1*d,-1*e,1*f,1*d,-1*e,1*f,1*d,1*e,1*f,-1*d,1*e,1*f,-1*d,-1*e,-1*f,-1*d,1*e,-1*f,1*d,1*e,-1*f,1*d,-1*e,-1*f,-1*d,1*e,-1*f,-1*d,1*e,1*f,1*d,1*e,1*f,1*d,1*e,-1*f,-1*d,-1*e,-1*f,1*d,-1*e,-1*f,1*d,-1*e,1*f,-1*d,-1*e,1*f,1*d,-1*e,-1*f,1*d,1*e,-1*f,1*d,1*e,1*f,1*d,-1*e,1*f,-1*d,-1*e,-1*f,-1*d,-1*e,1*f,-1*d,1*e,1*f,-1*d,1*e,-1*f],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],this.indexes=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],this.uvs=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],OMEGA.Omega3D.Log("GEOMETRY : cube created")}function CylinderGeometry(a,b,c,d){Geometry.apply(this);var g,h,i,j,k,l,m,n,o,p,e=b||.25*this.scale,f=a||this.scale,c=c||15,d=d||10;l=new Array,m=new Array,n=new Array,o=new Array,p=new Array;for(var q=0;d>q;q++)for(var r=0;c>r;r++){j=2*Math.PI/(c-1)*r,k=Math.PI*q/(d-1)-Math.PI/2,g=Math.cos(j)*e,h=q*(f/d)-f/2,i=Math.sin(j)*e;var s=new Vector3(g,h,i),t=new Vector2(r/(c-1),q/(d-1)),u=new Vector3(Math.cos(j),0,Math.sin(j));l.push(s),n.push(u),m.push(t)}OMEGA.Omega3D.VBOUtil.ComputeTangentBasis(l,m,n,o,p),OMEGA.Omega3D.VBOUtil.IndexTB(l,m,n,o,p,this.vertices_raw,this.uvs_raw,this.normals_raw,this.tangents_raw,this.bitangents_raw),OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB(l,m,n,o,p,this.vertices,this.uvs,this.normals,this.tangents,this.bitangents),OMEGA.Omega3D.VBOUtil.ComputeIndices(c,d,this.indexes),Geometry.ComputeFaces(this.vertices,this.indexes,this.faces),OMEGA.Omega3D.Log("GEOMETRY : cillinder created")}function SphereGeometry(a,b,c){Geometry.apply(this),a&&(this.scale=a);var a=a||this.scale;c=c||15,b=b||15;var f,g,h,i,j,d=0,e=0;f=new Array,g=new Array,h=new Array,i=new Array,j=new Array;for(var k=0;c>k;k++)for(var l=0;b>l;l++){d=2*Math.PI/(b-1)*l,e=Math.PI*k/(c-1)-Math.PI/2;var m=Math.cos(d)*a*Math.cos(e),n=Math.sin(e)*a,o=Math.sin(d)*a*Math.cos(e),p=new Vector3(m,n,o),q=new Vector2(l/(b-1),1-k/(c-1)),r=new Vector3(Math.cos(d)*Math.cos(e),Math.sin(e),Math.sin(d)*Math.cos(e));f.push(p),h.push(r),g.push(q)}OMEGA.Omega3D.VBOUtil.ComputeTangentBasis(f,g,h,i,j),OMEGA.Omega3D.VBOUtil.IndexTB(f,g,h,i,j,this.vertices_raw,this.uvs_raw,this.normals_raw,this.tangents_raw,this.bitangents_raw),OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB(f,g,h,i,j,this.vertices,this.uvs,this.normals,this.tangents,this.bitangents),OMEGA.Omega3D.VBOUtil.ComputeIndices(b,c,this.indexes),Geometry.ComputeFaces(this.vertices,this.indexes,this.faces),OMEGA.Omega3D.Log("GEOMETRY : sphere created")}function SquareGeometry(a,b,c,d){Geometry.apply(this);for(var e=a||1,f=b||1,c=c||150,d=d||150,g=2*a/(c-1),h=2*b/(d-1),i=0;d>i;i++)for(var j=0;c>j;j++){var k=-e+j*g,l=-f+i*h,m=0;this.vertices.push(k,l,m),this.normals.push(0),this.normals.push(0),this.normals.push(1),this.uvs.push(j/(c-1)),this.uvs.push(i/(d-1)),d-1>i&&c-1>j&&(this.indexes.push(i*c+j),this.indexes.push(i*c+j+1),this.indexes.push((i+1)*c+j),this.indexes.push(i*c+j+1),this.indexes.push((i+1)*c+j+1),this.indexes.push((i+1)*c+j))}OMEGA.Omega3D.Log("GEOMETRY : square created")}function TorusGeometry(a,b,c,d){Geometry.apply(this);for(var g,h,i,j,k,l,c=c||40,d=d||50,e=a||this.scale,f=b||e/2,m=0,n=0,o=0;c>o;o++){m=2*Math.PI/(c-1)*o;for(var p=0;d>p;p++)n=2*Math.PI/(d-1)*p,g=Math.cos(m)*(Math.cos(n)*f-e),h=Math.sin(m)*(Math.cos(n)*f-e),i=Math.sin(n)*f,j=Math.cos(m)*Math.cos(n),k=Math.sin(m)*Math.cos(n),l=Math.sin(n),this.vertices.push(g),this.vertices.push(h),this.vertices.push(i),this.normals.push(j),this.normals.push(k),this.normals.push(l),this.uvs.push(p/(d-1)),this.uvs.push(o/(c-1)),c-1>o&&d-1>p&&(this.indexes.push(o*d+p),this.indexes.push(o*d+p+1),this.indexes.push((o+1)*d+p),this.indexes.push(o*d+p+1),this.indexes.push((o+1)*d+p+1),this.indexes.push((o+1)*d+p))}for(var o=0;o<this.indexes.length;o+=9){var q={x:this.vertices[this.indexes[o]],y:this.vertices[this.indexes[o+1]],z:this.vertices[this.indexes[o+2]]},r={x:this.vertices[this.indexes[o+3]],y:this.vertices[this.indexes[o+4]],z:this.vertices[this.indexes[o+5]]},s={x:this.vertices[this.indexes[o+6]],y:this.vertices[this.indexes[o+7]],z:this.vertices[this.indexes[o+8]]};this.faces.push({a:q,b:r,c:s})}OMEGA.Omega3D.Log("GEOMETRY : torus created")}function TriangleGeometry(){Geometry.apply(this,arguments),this.vertices=[0,1*this.scale,0,-1*this.scale,-1*this.scale,0,1*this.scale,-1*this.scale,0],this.uvs=[.98,.98,.6,0,0,.6],this.normals=[0,0,1,0,0,1,0,0,1],this.indexes=[0,1,2],Geometry.ComputeTangentBasis(this.vertices,this.uvs,this.normals,this.tangents,this.bitangents),OMEGA.Omega3D.Log("GEOMETRY : triangle created")}function OBJParser(a){var b=String.fromCharCode(10),c=String.fromCharCode(32),d="/",e="v",f="vn",g="vt",h="f",i=!1,j=1,k=!1,l=0;this.debug=a||!1;var m=new Array,n=new Array,o=new Array,p=new Array,q=new Array,r=new Array,s=new Array,t=new Array,u=new Array;this.GetVertices=function(){return q},this.GetNormals=function(){return r},this.GetUVS=function(){return s
},this.GetIndexes=function(){return u},this.ParseToObject3D=function(a,b,c){this.parseFile(a,b);var d=new Omega3D.Geometry;d.SetVertices(this.GetVertices()),d.SetNormals(this.GetNormals()),d.SetUVS(this.GetUVS()),d.SetIndexes(this.GetIndexes());var e=new Omega3D.Mesh(d),f=new Omega3D.Object3D(e,c);return v(),f},this.ParseToMesh=function(a,b){this.parseFile(a,b);var c=new Omega3D.Geometry;c.SetVertices(this.GetVertices()),c.SetNormals(this.GetNormals()),c.SetUVS(this.GetUVS()),c.SetIndexes(this.GetIndexes());var d=new Omega3D.Mesh(c);return v(),d},this.parseFile=function(a,c){var d=this,e=new XMLHttpRequest||new ActiveXObject("MSXML2.XMLHTTP");e.open("GET",a,!1),e.onreadystatechange=function(){j=c;for(var g=e.responseText,h=g.split(b),i=h.length,k=0;i>k;k++)d.parseLine(h[k]);this.debug&&(console.log(a+" has been parsed, some info:"),console.log("VERTEXES : "+q.length/3),console.log("NORMALS  : "+r.length/3),console.log("UV       : "+s.length/2),console.log("INDEXES  : "+u.length))},e.send(null)},this.parseLine=function(a){var d,b=a.split(c);if(b.length>0){d=b.slice(1);var i=b[0];switch(i){case e:this.parseVertex(d);break;case f:this.parseNormal(d);break;case g:this.parseUV(d);break;case h:this.parseIndex(d)}}},this.parseVertex=function(a){if((""==a[0]||" "==a[0])&&(a=a.slice(1)),i)m.push(parseFloat(a[1])*j),m.push(parseFloat(a[2])*j),m.push(parseFloat(a[0])*j);else{var b=a.length;b>3&&(b=3);for(var c=0;b>c;++c){var d=a[c];p.push(Math.random()),m.push(parseFloat(d)*j)}p.push(1)}},this.parseNormal=function(a){(""==a[0]||" "==a[0])&&(a=a.slice(1));var b=a.length;b>3&&(b=3);for(var c=0;b>c;++c){var d=a[c];null!=d&&n.push(parseFloat(d))}},this.parseUV=function(a){(""==a[0]||" "==a[0])&&(a=a.slice(1));var b=a.length;b>2&&(b=2);for(var c=0;b>c;++c){var d=a[c];o.push(Number(d))}},this.parseIndex=function(a){for(var b,c,e,f,g,h,i,j=a.length,p=0;""==a[p]||" "==a[p];)p++;for(j=p+3,i=p;j>i;++i)b=a[i],c=b.split(d),e=parseInt(c[0])-1,f=parseInt(c[1])-1,g=parseInt(c[2])-1,0>e&&(e=0),0>f&&(f=0),0>g&&(g=0),h=3*e,q.push(m[h+0],m[h+1],m[h+2]),t.push(Math.random(),Math.random(),Math.random(),1),n.length&&(h=3*g,r.push(n[h+0],n[h+1],n[h+2])),h=2*f,k?s.push(o[h+0],1-o[h+1]):s.push(1-o[h+0],1-o[h+1]);u.push(l+0,l+1,l+2),l+=3};var v=function(){q=new Array,r=new Array,s=new Array,t=new Array,u=new Array,m=new Array,n=new Array,o=new Array,p=new Array,l=0}}function WebGLRenderer(a){var b=null,d=null,e=null,f=null;this.passes=new Array,this.materials=null,this.objects=null,this.list=null;var g=a||!1;this.autoClear=!0,this.shouldClear=!1,this.CLEAR_COLOR_BIT=!0,this.CLEAR_DEPTH_BIT=!0,this.CLEAR_STENCIL_BIT=!0,__construct=function(){b=mat4.create(),this.materials=new Array,this.objects=new Array,this.list=new Array,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}(),this.clear=function(a){var b=this.CLEAR_COLOR_BIT?OMEGA.Omega3D.GL.COLOR_BUFFER_BIT:0,c=this.CLEAR_DEPTH_BIT?OMEGA.Omega3D.GL.DEPTH_BUFFER_BIT:0,d=this.CLEAR_STENCIL_BIT?OMEGA.Omega3D.GL.STENCIL_BUFFER_BIT:0,a=a||{r:0,g:0,b:0,a:1};OMEGA.Omega3D.GL.clearColor(a.r,a.g,a.b,a.a),OMEGA.Omega3D.GL.clear(b|c|d)},this.viewPort=function(a,b,c,d,e){var f=a.getGL();f.viewport(b||0,c||0,d||f.viewPortWidth,e||f.viewPortHeight)},this.SetStencilParams=function(a,b,c,d,e){var f=a.getGL();b&&f.stencilFunc(b[0],b[1],b[2]),c&&f.stencilOp(c[0],c[1],c[2]),f.stencilMask(d),f.depthMask(e)},this.addRenderPass=function(a){this.passes.push(a),d?(a.prev=e,e.next=a,e=a):(d=a,e=d)},this.SetRenderChain=function(a){f=a},this.render=function(){OMEGA.Omega3D.AVAILABLE&&f.Render()},this.renderSceneToStencil=function(a,b){b.update(),this.materials=a.materials,this.objects=a.objects,this.list=a.list;var c=a.getGL();c.enable(c.STENCIL_TEST),a.getColor(),c.disable(c.STENCIL_TEST)},this.RenderPostProcessing=function(){},this.renderScene=function(a,b){g&&console.log("Renderer.Render START"),this.clear(a.getColor());var c=a.getGL();this.materials=a.materials,this.objects=a.objects,this.list=a.list,this.shouldClear=!0,typeof b==DepthCamera&&(this.shouldClear=!1);for(var d=0;d<this.materials.length;d++){var e=this.materials[d].id,f=this.materials[d].material;if(this.objects[e]){g&&OMEGA.Omega3D.Log("Current Material ID :  "+e+"\nAmount Objects for this material: "+this.objects[e].length);for(var j=f.GetTextures(),k=j.length,l=0;k>l;l++)j[l].needsUpdate&&j[l].Update();f.Enable(),f.GetShader().GetProgram().uProjectionMatrix&&null!=b&&c.uniformMatrix4fv(f.GetShader().GetProgram().uProjectionMatrix,!1,b.GetProjectionMatrix()),f.GetShader().GetProgram().uViewMatrix&&null!=b&&c.uniformMatrix4fv(f.GetShader().GetProgram().uViewMatrix,!1,b.GetMatrix()),f.GetShader().GetProgram().uInvViewMatrix&&null!=b&&c.uniformMatrix4fv(f.GetShader().GetProgram().uInvViewMatrix,!1,b.GetInverseMatrix());for(var m in f.custom_uniforms){var n=f.custom_uniforms[m];"int"==n.type?c.uniform1i(f.GetShader().GetProgram()[m],n.value):"float"==n.type?c.uniform1f(f.GetShader().GetProgram()[m],n.value):"mat4"==n.type?c.uniformMatrix4fv(f.GetShader().GetProgram()[m],!1,n.value):"mat3"==n.type?c.uniformMatrix3fv(f.GetShader().GetProgram()[m],!1,n.value):"vec4"==n.type?c.uniform4fv(f.GetShader().GetProgram()[m],n.value):"vec3"==n.type?c.uniform3fv(f.GetShader().GetProgram()[m],n.value):"vec2"==n.type&&c.uniform2fv(f.GetShader().GetProgram()[m],n.value)}a.getLights().length>0&&i(a,f);for(var o=this.list[e].head;o;)o.mayRender&&(h(c,o,f,b),g&&OMEGA.Omega3D.Log("-  Current object: "+o)),o=o.next;f.Disable()}}g&&OMEGA.Omega3D.Log("Renderer.Render END")};var h=function(a,b,c,d){null!=d&&(b.Update(a,d),b instanceof LODObject3D&&b.adjustLODLevel(d));var e=c.GetShader().GetProgram();for(var f in c.custom_attribs)a.enableVertexAttribArray(e[f]),a.bindBuffer(a.ARRAY_BUFFER,c.custom_attribs[f].value),a.vertexAttribPointer(e[f],c.custom_attribs[f].value.itemSize,a.FLOAT,!1,0,0);a.uniformMatrix4fv(e.uModelMatrix,!1,b.GetMatrix());var g=mat4.create(),h=mat3.create();null!=d&&(mat4.multiply(g,d.GetMatrix(),b.GetMatrix()),mat3.fromMat4(h,g),mat3.invert(h,h),mat3.transpose(h,h)),a.uniformMatrix3fv(e.uNormalMatrix,!1,h),a.uniform1f(e.uPointSize,parseFloat(OMEGA.Omega3D.PointSize)),a.enableVertexAttribArray(e.aVertexPos),a.bindBuffer(a.ARRAY_BUFFER,b.GetMesh().GetVertexBuffer()),a.vertexAttribPointer(e.aVertexPos,b.GetMesh().GetVertexBuffer().itemSize,a.FLOAT,!1,0,0),-1!=e.aTextureCoord&&void 0!=b.GetMesh().GetUVBuffer()&&(a.enableVertexAttribArray(e.aTextureCoord),a.bindBuffer(a.ARRAY_BUFFER,b.GetMesh().GetUVBuffer()),a.vertexAttribPointer(e.aTextureCoord,b.GetMesh().GetUVBuffer().itemSize,a.FLOAT,!1,0,0)),-1!=e.aVertexNormal&&void 0!=b.GetMesh().GetNormalBuffer()&&(a.enableVertexAttribArray(e.aVertexNormal),a.bindBuffer(a.ARRAY_BUFFER,b.GetMesh().GetNormalBuffer()),a.vertexAttribPointer(e.aVertexNormal,b.GetMesh().GetNormalBuffer().itemSize,a.FLOAT,!1,0,0)),-1!=e.aVertexTangent&&void 0!=b.GetMesh().GetTangentBuffer()&&(a.enableVertexAttribArray(e.aVertexTangent),a.bindBuffer(a.ARRAY_BUFFER,b.GetMesh().GetTangentBuffer()),a.vertexAttribPointer(e.aVertexTangent,b.GetMesh().GetTangentBuffer().itemSize,a.FLOAT,!1,0,0)),-1!=e.aVertexBitangent&&void 0!=b.GetMesh().GetBitangentBuffer()&&(a.enableVertexAttribArray(e.aVertexBitangent),a.bindBuffer(a.ARRAY_BUFFER,b.GetMesh().GetBitangentBuffer()),a.vertexAttribPointer(e.aVertexBitangent,b.GetMesh().GetBitangentBuffer().itemSize,a.FLOAT,!1,0,0)),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.GetMesh().GetIndexBuffer()),b.drawType==OMEGA.Omega3D.Object3D.DEFAULT?a.drawElements(a.TRIANGLES,b.GetMesh().GetIndexBuffer().numItems,a.UNSIGNED_SHORT,b.GetMesh().GetIndexBuffer()):b.drawType==OMEGA.Omega3D.Object3D.WIREFRAME?a.drawElements(a.LINE_STRIP,b.GetMesh().GetIndexBuffer().numItems,a.UNSIGNED_SHORT,b.GetMesh().GetGeometry().GetVertices()/3):b.drawType==OMEGA.Omega3D.Object3D.POINTS?a.drawArrays(a.POINTS,0,b.GetMesh().GetVertexBuffer().numItems):b.drawType==OMEGA.Omega3D.Object3D.TRIANGLES&&a.drawArrays(a.TRIANGLES,0,b.GetMesh().GetGeometry().GetVertices().length/3),-1!=e.aVertexPos&&a.disableVertexAttribArray(e.aVertexPos),-1!=e.aTextureCoord&&a.disableVertexAttribArray(e.aTextureCoord),-1!=e.aVertexNormal&&a.disableVertexAttribArray(e.aVertexNormal),-1!=e.aTangent&&a.disableVertexAttribArray(e.aBitangent),-1!=e.aBitangent&&a.disableVertexAttribArray(e.aBitangent),b.PlaceBack(),null!=d&&b.LateUpdate(a,d)},i=function(a,b){var c=a.getGL(),d=a.getLights(),e=b.GetShader().GetProgram();for(var f in d)for(var g in d[f].uniforms)c.uniform3fv(e[g],d[f].uniforms[g].value.apply(d[f],null))}}function Pass(){this.next=null,this.prev=null,this.render=function(){}}function RenderPass(a,b,c){Pass.apply(this),a&&b&&c&&(this.renderer=a,this.scene=b,this.cam=c,this.gl=b.getGL(),this.color=b.getColor(),this.render=function(){this.cam.update(),this.scene.update(),this.gl.enable(this.gl.DEPTH_TEST),this.renderer.viewPort(this.scene),this.renderer.renderScene(this.scene,this.cam),this.gl.disable(this.gl.DEPTH_TEST)})}function ProxyPass(a,b,c){Pass.apply(this),this.next=null,this.prev=null,this.target=a,this.proxy=b,this.args=c||null,this.render=function(){this.proxy.apply(this.target,this.args)}}function ShadowMapPass(a,b,c,d){RenderPass.apply(this,[a,b,c]),this.texture=d;var e=new Omega3D.BasicTexture,f=new Omega3D.Shaders.Basic(!1,scene01);this.dummyMat=new Omega3D.Material(f,[e]),this.swapMaterialsForBasic=function(){for(var a=this.scene.children,b=0;b<a.length;b++);},this.render=function(){this.cam.update(),this.scene.update(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer()),this.gl.enable(this.gl.DEPTH_TEST),this.gl.cullFace(this.gl.FRONT),this.renderer.viewPort(this.scene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height),this.renderer.renderScene(this.scene,this.cam),this.gl.disable(this.gl.DEPTH_TEST),this.gl.cullFace(this.gl.BACK),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}function RenderToTexturePass(a,b,c,d){RenderPass.apply(this,[a,b,c]),this.texture=d,this.render=function(){this.cam.update(),this.scene.update(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.texture.GetFrameBuffer()),this.gl.enable(this.gl.DEPTH_TEST),this.renderer.viewPort(this.scene,0,0,this.texture.GetFrameBuffer().width,this.texture.GetFrameBuffer().height),this.renderer.renderScene(this.scene,this.cam),this.gl.disable(this.gl.DEPTH_TEST),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}function PostProcessingPass(a,b,c,d){RenderPass.apply(this,[a,b.parentScene,camera]),this.out_texture=d,this.in_shader=c,this.screen_quad=b,this.render=function(){this.scene.update(),this.screen_quad.GetMaterial().SetShader(this.in_shader),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.out_texture.GetFrameBuffer()),this.renderer.viewPort(this.scene,0,0,this.out_texture.GetFrameBuffer().width,this.out_texture.GetFrameBuffer().height),this.renderer.renderScene(this.scene,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.out_texture.Disable(),this.screen_quad.GetMaterial().SetTextures([this.out_texture])}}function StencilPass(a,b,c,d){RenderPass.apply(this,[a,b,c]);var e=d.stencilData,f=d.contentData;this.render=function(){this.cam.update(),this.scene.update(),this.gl.enable(this.gl.STENCIL_TEST),this.renderer.viewPort(this.scene),this.renderer.SetStencilParams(this.scene,e.stencilFuncData,e.stencilOpData,e.stencilMask,e.depthMask),this.renderer.renderScene(this.scene,this.cam),this.renderer.SetStencilParams(this.scene,f.stencilFuncData,f.stencilOpData,f.stencilMask,f.depthMask)}}function RenderChain(){var a=[],b=null,c=null,d=null;this.AddRenderPass=function(d){a.push(d),b?(d.prev=c,c.next=d,c=d):(b=d,c=b)},this.Render=function(){for(d=b;d;)d.render(),d=d.next}}function KeyListener(){this.active=!0,this.currentlyPressedKeys=[],this.HandleKeyDown=function(a){this.active&&(this.currentlyPressedKeys[a.keyCode]=a.keyCode)},this.HandleKeyUp=function(a){this.active&&delete this.currentlyPressedKeys[a.keyCode]},this.Enable=function(){this.active||(this.currentlyPressedKeys=[],this.active=!0)},this.Disable=function(){this.active&&(this.currentlyPressedKeys=[],this.active=!1)}}function DepthCamera(a){Camera.apply(this),this.light=a,this.size=5,this.GetProjectionMatrix=function(){return mat4.ortho(this.projectionMatrix,-this.size,this.size,-this.size,this.size,-this.size,2*this.size),this.projectionMatrix},this.LookAt(0,0,0,this.light.GetPosition())}var mat3={};if(mat3.create=function(){var a=new GLMAT_ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},mat3.clone=function(a){var b=new GLMAT_ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},mat3.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},mat3.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},mat3.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},mat3.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},mat3.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},mat3.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},mat3.mul=mat3.multiply,mat3.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},mat3.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},mat3.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},mat3.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},mat3.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},mat3.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},"undefined"!=typeof exports&&(exports.mat3=mat3),!GLMAT_EPSILON)var GLMAT_EPSILON=1e-6;if(!GLMAT_ARRAY_TYPE)var GLMAT_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;if(!GLMAT_RANDOM)var GLMAT_RANDOM=Math.random;var glMatrix={};glMatrix.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a},"undefined"!=typeof exports&&(exports.glMatrix=glMatrix);var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};var mat4={};mat4.create=function(){var a=new GLMAT_ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.clone=function(a){var b=new GLMAT_ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},mat4.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},mat4.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},mat4.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},mat4.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},mat4.mul=mat4.multiply,mat4.translate=function(a,b,c){var g,h,i,j,k,l,m,n,o,p,q,r,d=c[0],e=c[1],f=c[2];return b===a?(a[12]=b[0]*d+b[4]*e+b[8]*f+b[12],a[13]=b[1]*d+b[5]*e+b[9]*f+b[13],a[14]=b[2]*d+b[6]*e+b[10]*f+b[14],a[15]=b[3]*d+b[7]*e+b[11]*f+b[15]):(g=b[0],h=b[1],i=b[2],j=b[3],k=b[4],l=b[5],m=b[6],n=b[7],o=b[8],p=b[9],q=b[10],r=b[11],a[0]=g,a[1]=h,a[2]=i,a[3]=j,a[4]=k,a[5]=l,a[6]=m,a[7]=n,a[8]=o,a[9]=p,a[10]=q,a[11]=r,a[12]=g*d+k*e+o*f+b[12],a[13]=h*d+l*e+p*f+b[13],a[14]=i*d+m*e+q*f+b[14],a[15]=j*d+n*e+r*f+b[15]),a},mat4.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},mat4.rotate=function(a,b,c,d){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,e=d[0],f=d[1],g=d[2],h=Math.sqrt(e*e+f*f+g*g);return Math.abs(h)<GLMAT_EPSILON?null:(h=1/h,e*=h,f*=h,g*=h,i=Math.sin(c),j=Math.cos(c),k=1-j,l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8],u=b[9],v=b[10],w=b[11],x=e*e*k+j,y=f*e*k+g*i,z=g*e*k-f*i,A=e*f*k-g*i,B=f*f*k+j,C=g*f*k+e*i,D=e*g*k+f*i,E=f*g*k-e*i,F=g*g*k+j,a[0]=l*x+p*y+t*z,a[1]=m*x+q*y+u*z,a[2]=n*x+r*y+v*z,a[3]=o*x+s*y+w*z,a[4]=l*A+p*B+t*C,a[5]=m*A+q*B+u*C,a[6]=n*A+r*B+v*C,a[7]=o*A+s*B+w*C,a[8]=l*D+p*E+t*F,a[9]=m*D+q*E+u*F,a[10]=n*D+r*E+v*F,a[11]=o*D+s*E+w*F,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},mat4.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},mat4.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},mat4.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},mat4.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},mat4.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},mat4.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*g*f*j,a[15]=0,a},mat4.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},mat4.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},mat4.lookAt=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b[0],p=b[1],q=b[2],r=d[0],s=d[1],t=d[2],u=c[0],v=c[1],w=c[2];return Math.abs(o-u)<GLMAT_EPSILON&&Math.abs(p-v)<GLMAT_EPSILON&&Math.abs(q-w)<GLMAT_EPSILON?mat4.identity(a):(k=o-u,l=p-v,m=q-w,n=1/Math.sqrt(k*k+l*l+m*m),k*=n,l*=n,m*=n,e=s*m-t*l,f=t*k-r*m,g=r*l-s*k,n=Math.sqrt(e*e+f*f+g*g),n?(n=1/n,e*=n,f*=n,g*=n):(e=0,f=0,g=0),h=l*g-m*f,i=m*e-k*g,j=k*f-l*e,n=Math.sqrt(h*h+i*i+j*j),n?(n=1/n,h*=n,i*=n,j*=n):(h=0,i=0,j=0),a[0]=e,a[1]=h,a[2]=k,a[3]=0,a[4]=f,a[5]=i,a[6]=l,a[7]=0,a[8]=g,a[9]=j,a[10]=m,a[11]=0,a[12]=-(e*o+f*p+g*q),a[13]=-(h*o+i*p+j*q),a[14]=-(k*o+l*p+m*q),a[15]=1,a)},mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},"undefined"!=typeof exports&&(exports.mat4=mat4),Vector2.Multiply=function(a,b){return new Vector2(a.x*b.x,a.y*b.y)},Vector2.MultiplyByValue=function(a,b){return new Vector2(a.x*b,a.y*b)},Vector2.Subtract=function(a,b){return new Vector2(a.x-b.x,a.y-b.y)},Vector2.Equals=function(a,b){return a.x==b.x&&a.y==b.y},Vector3.Multiply=function(a,b){return new Vector3(a.x*b.x,a.y*b.y,a.z*b.z)},Vector3.MultiplyByValue=function(a,b){return new Vector3(a.x*b,a.y*b,a.z*b)},Vector3.Subtract=function(a,b){return new Vector3(a.x-b.x,a.y-b.y,a.z-b.z)},Vector3.Equals=function(a,b){return a.x==b.x&&a.y==b.y&&a.z==b.z};var OMEGA=OMEGA||{};OMEGA.Utils=function(){},OMEGA.Utils.prototype.LoadScript=function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,d.onreadystatechange=b,d.onload=b,c.appendChild(d)},OMEGA.Utils.prototype.LoadScripts=function(a,b){for(var c=0;c<a.length;c++)this.LoadScript(a[c],c<a.length-1?null:b)},OMEGA.Utils.prototype.LoadImages=function(a,b){for(var c=[],d=a.length,e=function(){0==--d&&b(c)},f=0;d>f;++f){var g=this.LoadImage(a[f],e);c.push(g)}},OMEGA.Utils.prototype.LoadImage=function(a,b){var c=new Image;return c.src=a,c.onload=b,c},OMEGA.Utils.Counter=function(){this.startTime=(new Date).getTime(),this.time=(new Date).getTime(),this.frameTime=0,this.framesNumber=0,this.FPS=0},OMEGA.Utils.Counter.prototype.update=function(){this.framesNumber++,this.frameTime=((new Date).getTime()-this.time)/1e3,this.frameTime>1&&(this.FPS=Math.round(this.framesNumber/this.frameTime),this.time=(new Date).getTime(),this.framesNumber=0)},OMEGA.Utils.Counter.prototype.getFPS=function(){return this.FPS},OMEGA.Utils.Counter.prototype.getFrame=function(){return this.framesNumber},OMEGA.Utils.Counter.prototype.getFrameTime=function(){return this.frameTime},OMEGA.Utils.Counter.prototype.getTime=function(){return((new Date).getTime()-this.startTime)/1e3},OMEGA.Utils.Timeline=function(a){this.triggers=new Array,this.trigger_set=new Array,this.time=0,this.trigger_set_index=0,this.startTime=(new Date).getTime(),this.deltaTime=this.savedTime=0,this.upCommingTriggerTime=0,this.isEnabled=!1,this.isDebug=a||!1},OMEGA.Utils.Timeline.prototype.On=function(){this.isEnabled=!0},OMEGA.Utils.Timeline.prototype.Off=function(){this.isEnabled=!1},OMEGA.Utils.Timeline.prototype.Add=function(a,b){null==this.triggers[a]&&(this.triggers[a]=new Array),this.triggers[a].push(b),-1==this.trigger_set.indexOf(a)&&this.trigger_set.push(a)},OMEGA.Utils.Timeline.prototype.Reset=function(){this.Off(),this.trigger_set_index=-1,this.isDebug&&console.log("[OMEGA :: Timeline] - Reset!"),this.startTime=(new Date).getTime(),this.savedTime=0,this.On()},OMEGA.Utils.Timeline.prototype.Clear=function(){this.triggers=new Array,this.upCommingTriggerTime=0,this.trigger_set_index=0},OMEGA.Utils.Timeline.prototype.Tick=function(a){if(this.isEnabled){if(this.time=a||(new Date).getTime()-this.startTime,this.deltaTime=this.time-this.savedTime,this.upCommingTriggerTime=this.trigger_set[this.trigger_set_index],null!=this.triggers[this.upCommingTriggerTime]&&this.time-this.deltaTime<=this.upCommingTriggerTime&&this.time+this.deltaTime>=this.upCommingTriggerTime){this.isDebug&&console.log("[OMEGA :: Timeline] - TriggerSet: { trigger_time: "+this.upCommingTriggerTime+" current_time: "+this.time+" }");for(var b=0;b<this.triggers[this.upCommingTriggerTime].length;b++)this.triggers[this.upCommingTriggerTime][b]();this.trigger_set.length-1>this.trigger_set_index&&this.trigger_set_index++}this.savedTime=this.time}};var OMEGA=OMEGA||{};OMEGA.Omega3D=OMEGA.Omega3D||{},OMEGA.Omega3D=function(){this.canvas=document.getElementById("omega"),this.scenes=[],this.cameras=[],this.shaders=[],this.keylisteners=[],this.gl=null;try{this.gl=this.canvas.getContext("experimental-webgl",{stencil:!0}),null==this.gl&&(this.gl=canvas.getContext("webgl",{stencil:!0}))}catch(a){}return null==this.gl?(console.log("[Omega3D] Cant initiate WebGL!"),void 0):(OMEGA.Omega3D.AVAILABLE=!0,this.gl.viewPortWidth=this.canvas.width,this.gl.viewPortHeight=this.canvas.height,this.canvas.addEventListener("webglcontextlost",function(){OMEGA.Omega3D.AVAILABLE=!1},!1),this.canvas.addEventListener("webglcontextrestored",function(){OMEGA.Omega3D.AVAILABLE=!0},!1),window.addEventListener("resize",function(){Omega3D.Recalibrate()},!1),OMEGA.Omega3D.GL=this.gl,console.log(".: Omega3D v"+OMEGA.Omega3D.VERSION+" :."),void 0)},OMEGA.Omega3D.Recalibrate=function(){OMEGA.Omega3D.INSTANCE.canvas.width=window.innerWidth-5,OMEGA.Omega3D.INSTANCE.canvas.height=window.innerHeight-5,OMEGA.Omega3D.INSTANCE.gl.viewPortWidth=OMEGA.Omega3D.INSTANCE.canvas.width,OMEGA.Omega3D.INSTANCE.gl.viewPortHeight=OMEGA.Omega3D.INSTANCE.canvas.height},OMEGA.Omega3D.GetGL=function(){return OMEGA.Omega3D.INSTANCE.gl},OMEGA.Omega3D.AddKeyListener=function(a){OMEGA.Omega3D.INSTANCE.keylisteners.push(a),document.keylisteners=OMEGA.Omega3D.INSTANCE.keylisteners},OMEGA.Omega3D.RemoveKeyListener=function(a){OMEGA.Omega3D.INSTANCE.keylisteners.splice(OMEGA.Omega3D.INSTANCE.keylisteners.lastIndexOf(a),1),document.keylisteners=OMEGA.Omega3D.INSTANCE.keylisteners},OMEGA.Omega3D.ReadPixels=function(a,b,c,d,e){var f=OMEGA.Omega3D.INSTANCE.gl,g=f.createTexture();f.bindTexture(f.TEXTURE_2D,g),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);var h=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,h),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,g,0);var i=new Uint8Array(4*d*e);return f.readPixels(b,c,d,e,f.RGBA,f.UNSIGNED_BYTE,i),f.deleteFramebuffer(h),f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(g),i},OMEGA.Omega3D.CreateArrayBuffer=function(a,b){var c=OMEGA.Omega3D.INSTANCE.gl,d=c.createBuffer();return c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,a,c.STATIC_DRAW),d.itemSize=b,d.numItems=a.length/b,d},OMEGA.Omega3D.CreateAtlas=function(a,b,c,d,e,f,g){for(var h=a/c,i=b/d,j=0;i>j;j++)for(var k=0;h>k;k++){var l=k*c,m=j*d,n=0;e.push(l,m,n),f.push(k/(h-1)),f.push(j/(i-1)),i-1>j&&h-1>k&&(g.push(j*h+k),g.push(j*h+k+1),g.push((j+1)*h+k),g.push(j*h+k+1),g.push((j+1)*h+k+1),g.push((j+1)*h+k))}},window.onload=function(){document.getElementsByTagName("body"),OMEGA.Omega3D.INSTANCE=new OMEGA.Omega3D},document.keylisteners=[],document.onkeydown=function(a){for(var b=0;b<document.keylisteners.length;b++)document.keylisteners[b].HandleKeyDown(a)},document.onkeyup=function(a){for(var b=0;b<document.keylisteners.length;b++)document.keylisteners[b].HandleKeyUp(a)},String.prototype.splice=function(a,b,c){return this.slice(0,a)+c+this.slice(a+Math.abs(b))},OMEGA.Omega3D.Log=function(a){console.log(a)},OMEGA.Omega3D.GL=null,OMEGA.Omega3D.LIGHTS=[],OMEGA.Omega3D.PointSize=1,OMEGA.Omega3D.VERSION="0.0.1.5 Alpha",OMEGA.Omega3D.ScenesCount=0,OMEGA.Omega3D.ObjectsCount=0,OMEGA.Omega3D.MaterialsCount=0,OMEGA.Omega3D.INSTANCE=null,OMEGA.Omega3D.AVAILABLE=!1,OMEGA.Omega3D.KEEP=7680,OMEGA.Omega3D.REPLACE=7681,OMEGA.Omega3D.NEVER=512,OMEGA.Omega3D.LESS=513,OMEGA.Omega3D.EQUAL=514,OMEGA.Omega3D.LEQUAL=515,OMEGA.Omega3D.GREATER=516,OMEGA.Omega3D.NOTEQUAL=517,OMEGA.Omega3D.GEQUAL=518,OMEGA.Omega3D.ALWAYS=519;
var Omega3D=OMEGA.Omega3D;OMEGA.Omega3D.ShaderUtil=OMEGA.Omega3D.ShaderUtil||{},OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights=function(a,b,c,d){var e="",f="",g=d.getLights();if(0==g.length)return{vs:a,fs:b,uniforms:c};for(var h in g){e+=g[h].vs,f+=g[h].fs;for(var i in g[h].uniforms)c[i]=g[h].uniforms[i]}var j=a.indexOf("void main");j=0>j?0:j,a=a.splice(j,0,e);var k=a.match(/(void main\(\)|void main\(void\))(\{|\s\{)?/g),l=k;l+="vec3 injctd_tNormal  = uNormalMatrix * aVertexNormal;";var m=!0;for(var h in g)g[h].type==OMEGA.Omega3D.POINT_LIGHT?(m&&(l+="vec4 injctd_mvVertex = uViewMatrix * uModelMatrix * vec4(aVertexPos.xyz, 1.0);",m=!1),l=l+"vLightWeight += light"+h+"(injctd_tNormal);"):l=l+"vLightWeight += light"+h+"(injctd_tNormal);";a=a.replace(/(void main\(\)|void main\(void\))(\{|\s\{)?/g,l),b=b.splice(b.indexOf("void main"),0,f),b.match(/gl_FragColor.+;/g);var o="gl_FragColor = vec4( vLightWeight.rgb * color.rgb, color.a);";return b=b.replace(/gl_FragColor.+;/g,o),OMEGA.Omega3D.Log(" >> ShaderUtil: Injected "+g.length+" lights into Shader."),{vs:a,fs:b,uniforms:c}},OMEGA.Omega3D.VBOUtil=OMEGA.Omega3D.VBOUtil||{},OMEGA.Omega3D.VBOUtil.GetSimularVertexIndex=function(a,b,c,d,e,f,g){for(var h=d.length,i=0;h>i;i++)if(a.x==d[i].x&&a.y==d[i].y&&a.z==d[i].z&&b.x==e[i].x&&b.y==e[i].y&&c.x==f[i].x&&c.y==f[i].y&&c.z==f[i].z)return g=i,!0;return!1},OMEGA.Omega3D.VBOUtil.IndexTB=function(a,b,c,d,e,f,g,h,i,j){for(var k=0;k<a.length;k++){var l=-1,m=OMEGA.Omega3D.VBOUtil.GetSimularVertexIndex(a[k],b[k],c[k],f,g,h,l);m?(i[l].add(d[k]),j[l].add(e[k])):(f.push(a[k]),g.push(b[k]),h.push(c[k]),i.push(d[k]),j.push(e[k]))}},OMEGA.Omega3D.VBOUtil.ComputeIndices=function(a,b,c){for(var d=0;b>d;d++)for(var e=0;a>e;e++)b-1>d&&a-1>e&&(c.push(d*a+e,d*a+e+1,(d+1)*a+e),c.push(d*a+e+1,(d+1)*a+e+1,(d+1)*a+e))},OMEGA.Omega3D.VBOUtil.FlattenMeshDataTB=function(a,b,c,d,e,f,g,h,i,j){for(var k=0;k<a.length;k++)f.push(a[k].x,a[k].y,a[k].z),g.push(b[k].x,b[k].y),h.push(c[k].x,c[k].y,c[k].z),i.push(d[k].x,d[k].y,d[k].z),j.push(e[k].x,e[k].y,e[k].z)},OMEGA.Omega3D.VBOUtil.ComputeTangentBasis=function(a,b,c,d,e){for(var f=3,g=0;g<a.length;g+=f){var h=a[g+0],i=a[g+1],j=a[g+2];if(null==h||null==i||null==j)break;var k=b[g+0],l=b[g+1],m=b[g+2],n=Vector3.Subtract(i,h),o=Vector3.Subtract(j,h),p=Vector2.Subtract(l,k),q=Vector2.Subtract(m,k),r=1/(p.x*q.y-p.y*q.x),s=Vector3.MultiplyByValue(Vector2.Subtract(Vector3.MultiplyByValue(n,q.y),Vector3.MultiplyByValue(o,p.y)),r),t=Vector3.MultiplyByValue(Vector3.Subtract(Vector3.MultiplyByValue(o,p.x),Vector3.MultiplyByValue(n,q.x)),r);d.push(s),d.push(s),d.push(s),e.push(t),e.push(t),e.push(t)}},OMEGA.Omega3D.Object3D=Object3D,OMEGA.Omega3D.Object3D.DEFAULT=0,OMEGA.Omega3D.Object3D.POINTS=1,OMEGA.Omega3D.Object3D.WIREFRAME=2,OMEGA.Omega3D.Object3D.TRIANGLES=3,LODObject3D.prototype=Object3D,OMEGA.Omega3D.LODObject3D=LODObject3D,Cube.prototype=new Object3D,OMEGA.Omega3D.Cube=Cube,OMEGA.Omega3D.Light=function(a,b,c,d){Object3D.apply(this,[null,null]),this.SetDirection=function(a,b,c){this.direction[0]=a,this.direction[1]=b,this.direction[2]=c,this.invdirection[0]=-a,this.invdirection[1]=-b,this.invdirection[2]=-c,this.LookAt(a,b,c,this.position)},this.SetAmbient=function(a,b,c){this.ambientColor[0]=a,this.ambientColor[1]=b,this.ambientColor[2]=c},this.SetDiffuse=function(a,b,c){this.diffuseColor[0]=a,this.diffuseColor[1]=b,this.diffuseColor[2]=c},this.SetSpecular=function(a,b,c){this.specularColor[0]=a,this.specularColor[1]=b,this.specularColor[2]=c},this.GetDirection=function(){return this.direction},this.GetSpecular=function(){return this.specularColor},this.GetDiffuse=function(){return this.diffuseColor},this.GetAmbient=function(){return this.ambientColor},this.GetInvDirection=function(){return this.invdirection},this.LookAt=function(a,b,c,d){mat4.identity(e),mat4.lookAt(e,d||this.position,[a,b,c],[0,1,0])},this.GetMatrix=function(){return mat4.identity(this.modelView),mat4.multiply(this.modelView,this.rMatrix,this.tMatrix),mat4.multiply(this.modelView,this.modelView,this.sMatrix),mat4.multiply(this.modelView,this.modelView,e),this.modelView},this.GenerateGLSL=function(){0==this.type?this.glsl=this.genDirectional():1==this.type?this.glsl=this.genPoint():2==this.type&&(this.glsl=this.genSpot())},this.genUniforms=function(){var a="";return 0!=this.type&&(a+="uniform vec3 u"+this.id+"Position;\n",a+="uniform vec3 u"+this.id+"Specular;\n",this.uniforms["u"+this.id+"Position"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Position;",value:this.GetPosition},this.uniforms["u"+this.id+"Specular"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Specular;",value:this.GetSpecular}),a+="uniform vec3 u"+this.id+"Direction;\n",a+="uniform vec3 u"+this.id+"Ambient;\n",a+="uniform vec3 u"+this.id+"Diffuse;\n",this.uniforms["u"+this.id+"Direction"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Direction;",value:this.GetDirection},this.uniforms["u"+this.id+"Ambient"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Ambient;",value:this.GetAmbient},this.uniforms["u"+this.id+"Diffuse"]={type:"vec3",glsl:"uniform vec3 u"+this.id+"Diffuse;",value:this.GetDiffuse},a},this.genVarying=function(){var a=["varying vec3 vLightWeight;"].join("\n");return a},this.genDirectional=function(){var a=this.genUniforms(),b=0==this.index?this.genVarying():"";this.vs=[a,b,"vec3 "+this.id+"( vec3 tNormal ){","vec3 lightDir = normalize( u"+this.id+"Direction );","float dirLightWeight  = max(dot(tNormal, lightDir), 0.0);","vec3 lightFinalColor = u"+this.id+"Ambient + u"+this.id+"Diffuse * dirLightWeight;","return lightFinalColor;","}"].join("\n"),this.fs=[b].join("\n")},this.genPoint=function(){var a=this.genUniforms(),b=0==this.index?this.genVarying():"";this.vs=[a,b,"vec3 "+this.id+"( vec3 tNormal ){","vec4 mvVertex = uViewMatrix * uModelMatrix * vec4( aVertexPos.xyz, 1.0);","vec4 mvLight  = uViewMatrix * vec4(u"+this.id+"Position, 1.0);","vec3 lightDir = normalize( mvLight.xyz - mvVertex.xyz );","float dirLightWeight  = max(dot(tNormal, lightDir), 0.0);","vec3 reflectionVector  = normalize(reflect(lightDir, tNormal));vec3 viewVectorEye     = normalize(mvVertex.xyz);float rdotv  = max(dot(reflectionVector, viewVectorEye), 0.0);float specularLightWeighting = pow(rdotv, 10.0);vec3 lightFinalColor = u"+this.id+"Ambient + (u"+this.id+"Diffuse * dirLightWeight);","return lightFinalColor;","}"].join("\n"),this.fs=[b].join("\n")},this.genSpot=function(){},this.uniforms={},this.type=a||0,this.vs="",this.fs="",this.index=OMEGA.Omega3D.LIGHTS.length,this.id="light"+this.index.toString(),this.direction=[0,0,0],this.invdirection=[0,0,0];var e=mat4.create();this.ambientColor=b||[0,0,0],this.diffuseColor=c||[.1,.1,.1],this.specularColor=d||[0,0,0],OMEGA.Omega3D.LIGHTS.push(this),this.GenerateGLSL()},OMEGA.Omega3D.DIRECTIONAL_LIGHT=0,OMEGA.Omega3D.POINT_LIGHT=1,OMEGA.Omega3D.SPOT_LIGHT=2,OMEGA.Omega3D.Scene=function(){this.id=(++OMEGA.Omega3D.ScenesCount).toString(),this.name="Scene_"+this.id,this.renderer=null,this.gl=OMEGA.Omega3D.GL,this.children=new Array,this.objects=new Array,this.materials=new Array,this.list=new Array,this.lights=new Array,this.counter=new OMEGA.Utils.Counter,this.color={r:0,g:0,b:0,a:1},this.getLights=function(){return this.lights},this.addLight=function(a){this.lights.push(a)},this.removeLight=function(a){this.lights.splice(this.lights.indeOf(a),1)},this.getColor=function(){return this.color},this.setColor=function(a,b,c){this.color={r:a,g:b,b:c,a:1},this.gl.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},this.checkForMaterial=function(a){for(var b=0;b<this.materials.length;b++)if(this.materials[b].id==a)return!0;return!1},this.setName=function(a){this.name=a},this.getName=function(){return this.name},this.getID=function(){return this.id},this.getMaterials=function(a){return materials[a]},this.getObjectsFromMaterialID=function(a){return objects[a]}},OMEGA.Omega3D.Scene.prototype.getGL=function(){return this.gl},OMEGA.Omega3D.Scene.prototype.addChild=function(a){this.children.push(a),a.parentScene=this,this.checkForMaterial(a.GetMaterial().GetID())||this.materials.push({id:a.GetMaterial().GetID(),material:a.GetMaterial()});var b=a.GetMaterial().GetID();""==b&&(b="default"),null==this.objects[b]&&(this.objects[b]=new Array),this.objects[b].push(a),null==this.list[b]?(this.list[b]={head:a,tail:null},a.prev=null,a.next=null):null==this.list[b].tail?(this.list[b].tail=a,a.prev=this.list[b].head,this.list[b].head.next=a):(a.prev=this.list[b].tail,this.list[b].tail.next=a,this.list[b].tail=a)},OMEGA.Omega3D.Scene.prototype.removeChild=function(a){for(var b=0;b<this.children.length;b++)this.children[b]==a&&this.children.splice(b,1);var c=a.GetMaterial().GetID();if(this.list[c].head==a?null!=a.next?(this.list[c].head=a.next,this.list[c].head.prev=null):(this.list[c].head=null,this.list[c]=null):this.list[c].head!=a&&this.list[c].tail==a?null!=a.prev&&(this.list[c].tail=a.prev,this.list[c].tail.next=null):this.list[c].head!=a&&this.list[c].tail!=a&&null!=a.prev&&null!=a.next&&(a.prev.next=a.next,a.next.prev=a.prev.next),!this.objects[c])return a=null,void 0;for(var b=0;b<this.objects[c].length;b++)this.objects[c][b]==a&&this.objects[c].splice(b,1);0==this.objects[c].length&&(this.objects[c]=null),a.parentScene=null,a=null},OMEGA.Omega3D.Scene.prototype.update=function(){this.counter.update()},OMEGA.Omega3D.Scene.prototype.getTime=function(){return this.counter.getTime()},OMEGA.Omega3D.Scene.prototype.getFPS=function(){return this.counter.getFPS()},OMEGA.Omega3D.Scene.prototype.getFrameNumber=function(){return this.counter.getFrame()},Camera.prototype=new Object3D,OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{},OMEGA.Omega3D.cameras.Camera=Camera,FreeCamera.prototype=new Camera,OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{},OMEGA.Omega3D.cameras.FreeCamera=FreeCamera,OMEGA.Omega3D.Material=Material,SEMMaterial.prototype=new Material,OMEGA.Omega3D.SEMMaterial=SEMMaterial,ShaderMaterial.prototype=new Material,OMEGA.Omega3D.ShaderMaterial=ShaderMaterial,ShadowMapMaterial.prototype=new Material,OMEGA.Omega3D.ShadowMapMaterial=ShadowMapMaterial,CubeMapMaterial.prototype=new Material,OMEGA.Omega3D.CubeMapMaterial=CubeMapMaterial,BasicMaterial.prototype=new Material,OMEGA.Omega3D.BasicMaterial=BasicMaterial,OMEGA.Omega3D.Shaders=OMEGA.Omega3D.Shaders||{},OMEGA.Omega3D.Shaders.Components=OMEGA.Omega3D.Shaders.Components||{},OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float=function(){return"precision mediump float;"},OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords=function(){return"vTexCoord = aTextureCoord;"},OMEGA.Omega3D.Shaders.Components.Basic_Includes=function(){var a="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;uniform float uPointSize;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat4 uInvViewMatrix;uniform mat3 uNormalMatrix;";return a},OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing=function(){var a="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;uniform float uTime;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat3 uNormalMatrix;";return a},OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3=function(a,b){return a+" = uProjectionMatrix * uViewMatrix * uModelMatrix *    vec4("+b+", 1.0);"},OMEGA.Omega3D.Shaders.Components.Vertex_View_Conversion_V3=function(a,b){return a+" = uProjectionMatrix * uViewMatrix * uModelMatrix *    vec4("+b+", 1.0);"},OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3=function(a,b){return a+" = vec4("+b+", 1.0);"},OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic=function(a){return"gl_FragColor = "+a+";"},OMEGA.Omega3D.Shaders.Components.Noise3D=function(){var a="vec3 mod289(vec3 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 mod289(vec4 x) {return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 permute(vec4 x) {return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}float pnoise(vec3 P, vec3 rep){    vec3 Pi0 = mod(floor(P), rep);    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep);    Pi0 = mod289(Pi0);    Pi1 = mod289(Pi1);    vec3 Pf0 = fract(P);    vec3 Pf1 = Pf0 - vec3(1.0);    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);    vec4 iy = vec4(Pi0.yy, Pi1.yy);   vec4 iz0 = Pi0.zzzz;   vec4 iz1 = Pi1.zzzz;    vec4 ixy = permute(permute(ix) + iy);    vec4 ixy0 = permute(ixy + iz0);    vec4 ixy1 = permute(ixy + iz1);    vec4 gx0 = ixy0 * (1.0 / 7.0);    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;    gx0 = fract(gx0);    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);     vec4 sz0 = step(gz0, vec4(0.0));    gx0 -= sz0 * (step(0.0, gx0) - 0.5);    gy0 -= sz0 * (step(0.0, gy0) - 0.5);    vec4 gx1 = ixy1 * (1.0 / 7.0);    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;    gx1 = fract(gx1);    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);    vec4 sz1 = step(gz1, vec4(0.0));    gx1 -= sz1 * (step(0.0, gx1) - 0.5);    gy1 -= sz1 * (step(0.0, gy1) - 0.5);    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);   vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);   vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));    g000 *= norm0.x;   g010 *= norm0.y;    g100 *= norm0.z;   g110 *= norm0.w;    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));    g001 *= norm1.x;    g011 *= norm1.y;   g101 *= norm1.z;   g111 *= norm1.w;    float n000 = dot(g000, Pf0);    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));   float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));    float n111 = dot(g111, Pf1);    vec3 fade_xyz = fade(Pf0);    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);    return 2.2 * n_xyz;}";return a},OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes=function(){var a="uniform vec3 uLightPosition;uniform vec3 uLightDirection;uniform vec3 uAmbientColor;uniform vec3 uDiffuseColor;uniform vec3 uSpecularColor;";return a},OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying=function(){var a="varying vec3 vNormalEye;varying vec4 vPositionEye4;";return a},OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic=function(){var a="vPositionEye4 = gl_Position;vec3 temp = uNormalMatrix *aVertexNormal;vNormalEye = normalize(temp);";return a},OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Fragment_Logic=function(a){var b="vec3 vectorToLightSource    = normalize(uLightPosition.xyz-vPositionEye4.xyz );float diffuseLightWeighting = max(dot(vNormalEye, vectorToLightSource), 0.0);vec3 lightWeighting = uAmbientColor + uDiffuseColor * diffuseLightWeighting;vec4 texelColor = "+a+"gl_FragColor = vec4( lightWeighting.rgb * texelColor.rgb, texelColor.a);";return b},OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic=function(a){var b="vec3 vectorToLightSource    = normalize(uLightPosition.xyz-vPositionEye4.xyz );float diffuseLightWeighting = max(dot(vNormalEye, vectorToLightSource), 0.0);vec3 reflectionVector       = normalize(reflect(-vectorToLightSource, vNormalEye));vec3 viewVectorEye  = normalize(vPositionEye4.xyz);float rdotv  = max(dot(reflectionVector, viewVectorEye), 0.0);float specularLightWeighting = pow(rdotv, 8.0);vec3 lightWeighting = uAmbientColor + uDiffuseColor * diffuseLightWeighting + uSpecularColor * specularLightWeighting;vec4 texelColor = "+a+"gl_FragColor = vec4( lightWeighting.rgb * texelColor.rgb, texelColor.a);";return b},OMEGA.Omega3D.Shaders.Components.StandardAttributes=function(){var a={};return a.aTextureCoord={type:"vec2",glsl:"attribute vec2 aTextureCoord;",value:null},a.aVertexPos={type:"vec3",glsl:"attribute vec3 aVertexPos;",value:null},a.aVertexNormal={type:"vec3",glsl:"attribute vec3 aVertexNormal;",value:null},a.aVertexTangent={type:"vec3",glsl:"attribute vec3 aVertexTangent;",value:null},a.aVertexBitangent={type:"vec3",glsl:"attribute vec3 aVertexBitangent;",value:null},a},OMEGA.Omega3D.Shaders.Components.StandardUniforms=function(){var a={};return a.uModelMatrix={type:"mat4",glsl:"uniform mat4 uModelMatrix;",value:null},a.uProjectionMatrix={type:"mat4",glsl:"uniform mat4 uProjectionMatrix;",value:null},a.uViewMatrix={type:"mat4",glsl:"uniform mat4 uViewMatrix;",value:null},a.uInvViewMatrix={type:"mat4",glsl:"uniform mat4 uInvViewMatrix;",value:null},a.uNormalMatrix={type:"mat4",glsl:"uniform mat4 uNormalMatrix;",value:null},a.uPointSize={type:"float",glsl:"uniform float uPointSize;",value:null},a},OMEGA.Omega3D.Shaders.Components.StandardLightUniforms=function(){var a={};return a.uLightPosition={type:"vec3",glsl:"uniform vec3 uLightPosition;",value:null},a.uLightDirection={type:"vec3",glsl:"uniform vec3 uLightDirection;",value:null},a.uAmbientColor={type:"vec3",glsl:"uniform vec3 uAmbientColor;",value:null},a.uDiffuseColor={type:"vec3",glsl:"uniform vec3 uDiffuseColor;",value:null},a.uSpecularColor={type:"vec3",glsl:"uniform vec3 uSpecularColor;",value:null},a},OMEGA.Omega3D.Shader=Shader,OMEGA.Omega3D.Shaders=OMEGA.Omega3D.Shaders||{},OMEGA.Omega3D.Shaders.Basic=function(a,b,c){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Basic' shader"),OMEGA.Omega3D.Log("   -- Textured: "+a),OMEGA.Omega3D.Log("   -- Color: "+c);var d,e;a=a||!1,d=a?"varying vec2 vTexCoord;":"";var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();f+=d,f+="void main(void){gl_PointSize = uPointSize;",f+=OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos"),a&&(f+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")),f+="}",a?(d="uniform sampler2D uSampler;varying vec2 vTexCoord;",e="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"):e=c?"vec4("+c[0]+","+ +c[1]+","+ +c[2]+", 1.0);":"vec4(0.8,0.4,0.0, 1.0);";var g=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();a&&(g+=d),g+="void main(void){",g=g+"vec4 color = "+e,g+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),g+="}";var h=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),i=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(f,g,h,b);h=i.uniforms,f=i.vs,g=i.fs;var j={};return a&&(j.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}),new OMEGA.Omega3D.Shader(f,g,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),h,{},j])},OMEGA.Omega3D.Shaders.SEM=function(a){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Spherical Environment Mapping' shader");var b=OMEGA.Omega3D.Shaders.Components.Basic_Includes();b+="varying vec3 e;",b+="varying vec3 n;",b+="void main(void){gl_PointSize = uPointSize;",b+="e = normalize( vec3( uViewMatrix * uModelMatrix * vec4(aVertexPos.xyz, 1.0) ) );",b+="n = normalize( uNormalMatrix * aVertexNormal );",b+=OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos"),b+="}";var c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();c+="uniform sampler2D uSampler;",c+="varying vec3 e;",c+="varying vec3 n;",c+="void main(void){",c+="vec3 r = reflect( e, n );",c+="float m = 2.0 * sqrt( pow( r.x, 2.0) + pow( r.y, 2.0) + pow( r.z + 1.0, 2.0) );",c+="vec2 vN = r.xy / m + 0.5;",c+="vec4 color = texture2D(uSampler, vN);",c+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),c+="}";var d=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),e=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(b,c,d,a);d=e.uniforms,b=e.vs,c=e.fs;var f={};return f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(b,c,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),d,{},f])},OMEGA.Omega3D.Shaders.SM=function(a){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Shadow Mapping' shader");var b=OMEGA.Omega3D.Shaders.Components.Basic_Includes();b+="uniform mat4 uLightM;",b+="varying vec2 vTexCoord;",b+="varying vec4 vertexPosLight;",b+="void main(void){gl_PointSize = uPointSize;",b+="mat4 mvp       = uProjectionMatrix * uViewMatrix * uModelMatrix;",b+="mat4 mvp_light = uProjectionMatrix * uLightM * uModelMatrix;",b+="vec4 pos       = mvp * vec4(aVertexPos.xyz, 1.0);",b+="vertexPosLight = mvp_light * vec4(aVertexPos.xyz, 1.0);",b+="gl_Position    = pos;",b+="vTexCoord      = aTextureCoord;",b+="}";var c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();c+="uniform sampler2D uSampler;",c+="uniform sampler2D uShadowMap;",c+="varying vec2 vTexCoord;",c+="varying vec4 vertexPosLight;",c+="void main(void){",c+="vec3 nLightPos   = (vertexPosLight.xyz / vertexPosLight.w) / 2.0 + 0.5;",c+="vec4 depth       = texture2D(uShadowMap, vec2(nLightPos.xy));",c+="vec4 texture     = texture2D(uSampler, vec2(vTexCoord.st));",c+="float visibility = (nLightPos.z > (depth.r + 0.0001)) ? 0.7 : 1.0;",c+="vec4 color       = vec4( texture.rgb*visibility, 1.0);",c+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),c+="}";var d=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),e=OMEGA.Omega3D.ShaderUtil.InjectGLSLForLights(b,c,d,a);d=e.uniforms,b=e.vs,c=e.fs;var f={};f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},f.uShadowMap={id:"uShadowMap",type:"sampler2D",glsl:"",value:null};var g={};return g.uLightM={type:"mat4",glsl:"",value:""},new OMEGA.Omega3D.Shader(b,c,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),d,g,f])},OMEGA.Omega3D.Shaders.PostProcessing=function(a,b,c){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Basic PostProcessing' shader"),OMEGA.Omega3D.Log("   -- Textured: "+a),OMEGA.Omega3D.Log("   -- Color: "+c);var d,e;a=a||!1,d=a?"varying vec2 vTexCoord;":"";var f=OMEGA.Omega3D.Shaders.Components.Basic_Includes();f+=d,f+="void main(void){",f+=OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos"),a&&(f+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")),f+="}",a?(d="uniform sampler2D uSampler;varying vec2 vTexCoord;",e="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"):e=c?"vec4("+c[0]+","+ +c[1]+","+ +c[2]+", 1.0);":"vec4(0.8,0.4,0.0, 1.0);";var g=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();a&&(g+=d),g+="void main(void){",g=g+"vec4 color = "+e,g+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb, color.a)"),g+="}";var h=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),i={};return a&&(i.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}),new OMEGA.Omega3D.Shader(f,g,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),h,{},i])},OMEGA.Omega3D.Shaders.PP_ColorMultiply=function(a){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Basic PostProcessing' shader");var b;b="varying vec2 vTexCoord;";var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes();d+=b,d+="void main(void){",d+=OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos"),d+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),d+="}",b="uniform sampler2D uSampler;varying vec2 vTexCoord;";var e=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();e+=b,e+="void main(void){",e+="vec4 color = texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));",e+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb*"+a+", color.a)"),e+="}";var f=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),g={};return g.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(d,e,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),f,{},g])},OMEGA.Omega3D.Shaders.PP_Blur=function(a){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Basic PostProcessing' shader");var b;b="varying vec2 vTexCoord;";var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes();d+=b,d+="void main(void){",d+=OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos"),d+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),d+="}",b="uniform sampler2D uSampler;varying vec2 vTexCoord;";var e=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();e+=b,e+="void main(void){",e+="vec4 sum = vec4(0.0);",e+="vec2 tc = vTexCoord;",e=e+"float radius ="+a+";",e+="float resolution = 1024.0;",e+="float blur = radius / resolution;",e+="float hstep = 0.5;",e+="float vstep = 0.5;",e+="sum += texture2D(uSampler, vec2(tc.x - 4.0*blur*hstep, tc.y - 4.0*blur*vstep)) * 0.0162162162;",e+="sum += texture2D(uSampler, vec2(tc.x - 3.0*blur*hstep, tc.y - 3.0*blur*vstep)) * 0.0540540541;",e+="sum += texture2D(uSampler, vec2(tc.x - 2.0*blur*hstep, tc.y - 2.0*blur*vstep)) * 0.1216216216;",e+="sum += texture2D(uSampler, vec2(tc.x - 1.0*blur*hstep, tc.y - 1.0*blur*vstep)) * 0.1945945946;",e+="sum += texture2D(uSampler, vec2(tc.x, tc.y)) * 0.2270270270;",e+="sum += texture2D(uSampler, vec2(tc.x + 1.0*blur*hstep, tc.y + 1.0*blur*vstep)) * 0.1945945946;",e+="sum += texture2D(uSampler, vec2(tc.x + 2.0*blur*hstep, tc.y + 2.0*blur*vstep)) * 0.1216216216;",e+="sum += texture2D(uSampler, vec2(tc.x + 3.0*blur*hstep, tc.y + 3.0*blur*vstep)) * 0.0540540541;",e+="sum += texture2D(uSampler, vec2(tc.x + 4.0*blur*hstep, tc.y + 4.0*blur*vstep)) * 0.0162162162;",e+="vec4 color = texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));",e+=OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic("vec4(color.rgb * sum.rgb, color.a)"),e+="}";var f=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),g={};return g.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(d,e,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),f,{},g])},OMEGA.Omega3D.Shaders.PP_Bloom=function(){OMEGA.Omega3D.Log(" >> ShaderBuilder: Creating 'Basic PostProcessing' shader");var a;a="varying vec2 vTexCoord;";var c=OMEGA.Omega3D.Shaders.Components.Basic_Includes();c+=a,c+="void main(void){",c+=OMEGA.Omega3D.Shaders.Components.Vertex_ScreenSpace_Conversion_V3("gl_Position","aVertexPos"),c+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord"),c+="}",a="uniform sampler2D uSampler;varying vec2 vTexCoord;";var d=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();d+=a,d+="void main(void){",d+="vec4 sum = vec4(0.0);",d+="vec2 tc = vTexCoord;",d+="for( int i= -4 ;i < 4; i++){",d+="for ( int j = -3; j < 3; j++){",d+="sum += texture2D(uSampler, tc + vec2(j, i)*0.004) * 0.25;",d+="}",d+="}",d+="if (texture2D(uSampler, tc).r < 0.3){",d+="gl_FragColor = sum*sum*0.012 + texture2D(uSampler, tc);",d+="}else{",d+="if (texture2D(uSampler, tc).r < 0.5){",d+="gl_FragColor = sum*sum*0.009 + texture2D(uSampler, tc);",d+="}else{",d+="gl_FragColor = sum*sum*0.0075 + texture2D(uSampler, tc);",d+="}}}";var e=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),f={};return f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(c,d,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),e,{},f])},OMEGA.Omega3D.Shaders.Diffuse=function(a){var b,c;a=a||!1,b=a?"varying vec2 vTexCoord;":"";var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes();OMEGA.Omega3D.LIGHTS.length>0&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),d+=b,d+="void main(void){gl_PointSize = uPointSize;",d+=OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos"),a&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")),OMEGA.Omega3D.LIGHTS.length>0&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()),d+="}",a?(b="uniform sampler2D uSampler;varying vec2 vTexCoord;",c="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"):c="vec4(0.8, 0.4, 0.0, 1.0);";var e=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();OMEGA.Omega3D.LIGHTS.length>0&&(e=e+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),a&&(e+=b),e+="void main(void){",e+=OMEGA.Omega3D.LIGHTS.length>0?OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Fragment_Logic(c):OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(c),e+="}";var f={};return a&&(f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}),new OMEGA.Omega3D.Shader(d,e,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),OMEGA.Omega3D.Shaders.Components.StandardLightUniforms(),f])},OMEGA.Omega3D.Shaders.Phong=function(a){var b,c;a=a||!1,b=a?"varying vec2 vTexCoord;":"";var d=OMEGA.Omega3D.Shaders.Components.Basic_Includes();OMEGA.Omega3D.LIGHTS.length>0&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),d+=b,d+="void main(void){ gl_PointSize = uPointSize;",d+=OMEGA.Omega3D.Shaders.Components.Vertex_World_Conversion_V3("gl_Position","aVertexPos"),a&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_TextureCoords("vTexCoord")),OMEGA.Omega3D.LIGHTS.length>0&&(d+=OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()),d+="}",a?(b="uniform sampler2D uSampler;varying vec2 vTexCoord;",c="texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"):c="vec4(0.8, 0.4, 0.0, 1.0);";var e=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();OMEGA.Omega3D.LIGHTS.length>0&&(e=e+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),a&&(e+=b),e+="void main(void){",e+=OMEGA.Omega3D.LIGHTS.length>0?OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic(c):OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(c),e+="}";var f={};return a&&(f.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null}),new OMEGA.Omega3D.Shader(d,e,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),OMEGA.Omega3D.Shaders.Components.StandardLightUniforms(),f])},OMEGA.Omega3D.Shaders.CubeMap=function(){var b=OMEGA.Omega3D.Shaders.Components.Basic_Includes()+"varying vec3 vTexCoord;"+"void main(void){"+OMEGA.Omega3D.Shaders.Components.Vertex_View_Conversion_V3("gl_Position","aVertexPos")+"vTexCoord = (vec4(aVertexPos, 0.0)).xyz;"+"}",c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+"uniform samplerCube uSampler;"+"varying vec3 vTexCoord;"+"void main(void){"+"gl_FragColor = textureCube(uSampler, vTexCoord);"+"}",d=OMEGA.Omega3D.Shaders.Components.StandardUniforms(),e={};return e.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(b,c,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),d,{},e])},OMEGA.Omega3D.Shaders.Morph=function(){var a=OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing()+OMEGA.Omega3D.Shaders.Components.Noise3D();OMEGA.Omega3D.LIGHTS.length>0&&(a+=OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),a=a+"varying float noise;"+"float turbulence( vec3 p ) {"+"float t = -0.5;"+"for (float f = 1.0 ; f <= 10.0 ; f++){"+"float power = pow( 2.0, f );"+"t += abs( pnoise( vec3( power * p ), vec3( 10.0, 10.0, 10.0 ) ) / power );"+"}"+" return t;"+"}"+"varying float vTime;"+"varying vec2 vTexCoord;"+"varying vec3 vVertexNormal;"+"void main(void){"+"vec4 pos = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPos.xy, 0.0, 1.0);"+"noise = 10.0 *  -.10 * turbulence(.5*aVertexNormal + uTime * 0.025);"+"float b = 5.0 * pnoise(0.05 * aVertexPos, vec3(100.0) );"+"float displacement = - 1.5 * noise + b;"+"vec3 newPos = aVertexPos + aVertexNormal * displacement;"+"vVertexNormal = abs(aVertexNormal * displacement);"+"gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix *vec4(newPos, 1.0);"+"vTexCoord = aTextureCoord;"+"vTime = uTime;",OMEGA.Omega3D.LIGHTS.length>0&&(a+=OMEGA.Omega3D.Shaders.Components.Basic_Diffuse_Vertex_Logic()),a+="}";
    var b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float();OMEGA.Omega3D.LIGHTS.length>0&&(b=b+OMEGA.Omega3D.Shaders.Components.Basic_Light_Includes()+OMEGA.Omega3D.Shaders.Components.Basic_Light_Varying()),b=b+"uniform sampler2D uSampler;"+"varying float vTime;"+"varying vec2 vTexCoord;"+"varying float noise;"+"void main(void){"+"float n = noise;"+"if(noise < 0.05)n = 0.05;"+"if(noise > 0.4)n = 0.4;"+"float ypos = 1.0-1.3*n;"+"if(ypos < 0.0) ypos = 0.0;"+"vec2 tPos = vec2(0, ypos*1.7);";var c="texture2D(uSampler, tPos);";b+=OMEGA.Omega3D.LIGHTS.length>0?OMEGA.Omega3D.Shaders.Components.Basic_Phong_Fragment_Logic(c):OMEGA.Omega3D.Shaders.Components.Basic_Fragment_Logic(c),b+="}";var d={};return d.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(a,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),{},d])},OMEGA.Omega3D.Shaders.CubemapReflection=function(){var a="attribute vec2 aTextureCoord;attribute vec3 aVertexPos;attribute vec3 aVertexNormal;uniform float uPointSize;uniform mat4 uModelMatrix;uniform mat4 uProjectionMatrix;uniform mat4 uViewMatrix;uniform mat4 uInvViewMatrix;uniform mat3 uNormalMatrix;varying vec3 vTexCoord;void main(void){   vec3 vEyeNormal = uNormalMatrix * aVertexNormal;   vec4 vVert4 = uViewMatrix * uModelMatrix * vec4(aVertexPos, 1.0);   vec3 vEyeVertex = normalize(vVert4.xyz/vVert4.w);   vec4 vCoords = vec4(reflect(vEyeVertex.xyz, vEyeNormal.xyz), 1.0);   vCoords = uInvViewMatrix * vCoords;   vTexCoord.xyz = normalize(vCoords.xyz);   gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix *vec4(aVertexPos, 1.0);}",b=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+"varying vec3 vTexCoord;"+"uniform samplerCube uSampler;"+"void main(void){"+"   gl_FragColor = textureCube(uSampler, vTexCoord);"+"}",c={};return c.uSampler={id:"uSampler",type:"sampler2D",glsl:"",value:null},new OMEGA.Omega3D.Shader(a,b,[OMEGA.Omega3D.Shaders.Components.StandardAttributes(),OMEGA.Omega3D.Shaders.Components.StandardUniforms(),{},c])},OMEGA.Omega3D.Shaders.PostProcessingKernel=function(a){var b=OMEGA.Omega3D.Shaders.Components.Basic_Includes_Post_Processing()+"varying vec2 vTexCoord;"+"void main(void){"+"vec4 pos = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPos.xy, 0.0, 1.0);"+"gl_Position = pos;"+"vTexCoord = aTextureCoord;"+"}",c=OMEGA.Omega3D.Shaders.Components.Fragment_Precision_Mediump_Float()+"uniform float uKernel[9];"+"uniform sampler2D uSampler;"+"varying vec2 vTexCoord;"+"void main(void){"+"vec4 color = texture2D(uSampler, vec2(vTexCoord.s, vTexCoord.t));"+"vec2 onePixel = vec2(1.0, 1.0) / vec2(512, 512);"+"vec4 colorSum ="+"texture2D(uSampler, vTexCoord + onePixel * vec2(-1, -1)) * uKernel[1] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 0, -1)) * uKernel[1] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 1, -1)) * uKernel[2] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2(-1,  0)) * uKernel[3] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 0,  0)) * uKernel[4] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 1,  0)) * uKernel[5] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2(-1,  1)) * uKernel[6] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 0,  1)) * uKernel[7] + "+"texture2D(uSampler, vTexCoord + onePixel * vec2( 1,  1)) * uKernel[8];",d="float kernelWeight = uKernel[0] + uKernel[1] + uKernel[2] + uKernel[3] + uKernel[4] + uKernel[5] + uKernel[6] +uKernel[7] +uKernel[8];if(kernelWeight <= 0.0){kernelWeight = 1.0;}";return c+=d,c=c+"gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);"+"}",new OMEGA.Omega3D.PostProcessingKernelShader(b,c,a)},OMEGA.Omega3D.Shaders.PostProcessingKernel.Kernels={normal:[0,0,0,0,1,0,0,0,0],gaussianBlur:[.045,.122,.045,.122,.332,.122,.045,.122,.045],gaussianBlur2:[1,2,1,2,4,2,1,2,1],gaussianBlur3:[0,1,0,1,1,1,0,1,0],gaussianBlur4:[0,16,0,16,0,16,0,16,0],unsharpen:[-1,-1,-1,-1,9,-1,-1,-1,-1],sharpness:[0,-1,0,-1,5,-1,0,-1,0],sharpen:[0,-1,0,-1,16,-1,0,-1,0],edgeDetect:[-.125,-.125,-.125,-.125,1,-.125,-.125,-.125,-.125],edgeDetect2:[-1,-1,-1,-1,8,-1,-1,-1,-1],edgeDetect3:[-5,0,0,0,0,0,0,0,5],edgeDetect4:[-1,-1,-1,0,0,0,1,1,1],edgeDetect5:[-1,-1,-1,2,2,2,-1,-1,-1],edgeDetect6:[-5,-5,-5,-5,39,-5,-5,-5,-5],sobelHorizontal:[1,2,1,0,0,0,-1,-2,-1],sobelVertical:[1,0,-1,2,0,-2,1,0,-1],previtHorizontal:[1,1,1,0,0,0,-1,-1,-1],previtVertical:[1,0,-1,1,0,-1,1,0,-1],boxBlur:[.111,.111,.111,.111,.111,.111,.111,.111,.111],robbieBlur:[0,0,0,0,12,0,0,0,0],triangleBlur:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],emboss:[-2,-1,0,-1,1,1,0,1,2]},OMEGA.Omega3D.Texture=Texture,OMEGA.Omega3D.Texture.TEXTURE0=33984,BasicTexture.prototype=new Texture,OMEGA.Omega3D.BasicTexture=BasicTexture,CubemapTexture.prototype=new Texture,OMEGA.Omega3D.CubemapTexture=CubemapTexture,ShadowMapTexture.prototype=new Texture,OMEGA.Omega3D.ShadowMapTexture=ShadowMapTexture,FrameBufferTexture.prototype=new Texture,OMEGA.Omega3D.FrameBufferTexture=FrameBufferTexture,OMEGA.Omega3D.Mesh=Mesh,Geometry.ComputeIndices=function(a,b,c){for(var d=0;b>d;d++)for(var e=0;a>e;e++)b-1>d&&a-1>e&&(c.push(d*a+e,d*a+e+1,(d+1)*a+e),c.push(d*a+e+1,(d+1)*a+e+1,(d+1)*a+e))},Geometry.ComputeTangentBasis=function(a,b,c,d,e){for(var f=3,g=0;g<a.length;g+=f){var h=a[g+0],i=a[g+1],j=a[g+2],k=b[g+0],l=b[g+1],m=b[g+2],n=Vector3.Subtract(i,h),o=Vector3.Subtract(j,h),p=Vector2.Subtract(l,k),q=Vector2.Subtract(m,k),r=1/(p.x*q.y-p.y*q.x),s=Vector3.MultiplyByValue(Vector2.Subtract(Vector3.MultiplyByValue(n,q.y),Vector3.MultiplyByValue(o,p.y)),r),t=Vector3.MultiplyByValue(Vector3.Subtract(Vector3.MultiplyByValue(o,p.x),Vector3.MultiplyByValue(n,q.x)),r);d.push(s),d.push(s),d.push(s),e.push(t),e.push(t),e.push(t)}},Geometry.ComputeFaces=function(a,b,c){for(var d=0;d<b.length;d+=9){var e={x:a[b[d]],y:a[b[d+1]],z:a[b[d+2]]},f={x:a[b[d+3]],y:a[b[d+4]],z:a[b[d+5]]},g={x:a[b[d+6]],y:a[b[d+7]],z:a[b[d+8]]};c.push({a:e,b:f,c:g})}},OMEGA.Omega3D.Geometry=Geometry,CubeGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.CubeGeometry=CubeGeometry,CylinderGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.CylinderGeometry=CylinderGeometry,SphereGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.SphereGeometry=SphereGeometry,SquareGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.SquareGeometry=SquareGeometry,TorusGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.TorusGeometry=TorusGeometry,TriangleGeometry.prototype=new Geometry,OMEGA.Omega3D.Geometry.TriangleGeometry=TriangleGeometry,OMEGA.Omega3D.parsers=OMEGA.Omega3D.parsers||{},OMEGA.Omega3D.parsers.OBJParser=OBJParser,OMEGA.Omega3D.WebGLRenderer=WebGLRenderer,OMEGA.Omega3D.Pass=Pass,RenderPass.prototype=new Pass,OMEGA.Omega3D.RenderPass=RenderPass,RenderPass.prototype=new Pass,OMEGA.Omega3D.ProxyPass=ProxyPass,ShadowMapPass.prototype=new RenderPass,OMEGA.Omega3D.ShadowMapPass=ShadowMapPass,RenderToTexturePass.prototype=new RenderPass,OMEGA.Omega3D.RenderToTexturePass=RenderToTexturePass,PostProcessingPass.prototype=new RenderPass,OMEGA.Omega3D.PostProcessingPass=PostProcessingPass,StencilPass.prototype=new RenderPass,OMEGA.Omega3D.StencilPass=StencilPass,OMEGA.Omega3D.RenderChain=RenderChain,OMEGA.listeners=OMEGA.listeners||{},OMEGA.listeners.KeyListener=KeyListener,DepthCamera.prototype=new Camera,OMEGA.Omega3D.cameras=OMEGA.Omega3D.cameras||{},OMEGA.Omega3D.cameras.DepthCamera=DepthCamera;